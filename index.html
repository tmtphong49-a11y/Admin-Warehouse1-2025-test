

<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modern KPI Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              'brand-primary': '#6366F1', // Indigo 500
              'brand-secondary': '#EC4899', // Pink 500
              'brand-success': '#10B981', // Emerald 500
              'brand-danger': '#EF4444', // Red 500
              'brand-warning': '#F59E0B', // Amber 500
              
              // Dark Theme
              'dark-bg': '#0F172A', // Slate 900
              'dark-card': '#1E293B', // Slate 800
              'dark-border': '#334155', // Slate 700
              'dark-text-primary': '#F8FAFC', // Slate 50
              'dark-text-secondary': '#94A3B8', // Slate 400

              // Light Theme
              'light-bg': '#F1F5F9', // Slate 100
              'light-card': '#FFFFFF', // White
              'light-border': '#E2E8F0', // Slate 200
              'light-text-primary': '#0F172A', // Slate 900
              'light-text-secondary': '#64748B', // Slate 500
            },
            fontFamily: {
                sans: ['Inter', 'sans-serif'],
            },
          }
        }
      }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
    "react/": "https://aistudiocdn.com/react@^19.1.1/",
    "react": "https://aistudiocdn.com/react@^19.1.1",
    "recharts/": "https://aistudiocdn.com/recharts@^3.2.1/",
    "recharts": "https://aistudiocdn.com/recharts@^3.2.1",
    "xlsx": "https://cdn.sheetjs.com/xlsx-latest/package/xlsx.mjs",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
    "firebase/analytics": "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js",
    "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
    "firebase/storage": "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"
  }
}
</script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
  <body class="bg-light-bg text-light-text-primary dark:bg-dark-bg dark:text-dark-text-primary font-sans">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
// Import external dependencies
import React, { useState, useEffect, useRef, useMemo, createContext, useContext } from 'react';
import ReactDOM from 'react-dom/client';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LabelList, LineChart, Line, Legend } from 'recharts';
import { read, utils } from 'xlsx';

// Import Firebase dependencies
import { initializeApp } from 'firebase/app';
import { getAnalytics } from 'firebase/analytics';
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from 'firebase/firestore';
import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBHguqBiwres4qMDstnaq-4KYQiRb0JTgE",
  authDomain: "admin-wh1.firebaseapp.com",
  projectId: "admin-wh1",
  storageBucket: "admin-wh1.firebasestorage.app",
  messagingSenderId: "1072795813221",
  appId: "1:1072795813221:web:e27f6787c25c734d83cd8c",
  measurementId: "G-CEK74QFCW8"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);
const auth = getAuth(app);

// Firebase connection status
let firebaseConnected = false;

// Test Firebase connection
const testFirebaseConnection = async () => {
  try {
    // Sign in anonymously to test connection
    await signInAnonymously(auth);
    firebaseConnected = true;
    console.log('‚úÖ Firebase connected successfully!');
    
    // Test Firestore connection
    const testCollection = collection(db, 'test');
    console.log('‚úÖ Firestore connection established!');
    
    return true;
  } catch (error) {
    console.error('‚ùå Firebase connection failed:', error);
    firebaseConnected = false;
    return false;
  }
};

// Initialize Firebase connection on app start
testFirebaseConnection();

// Firestore helper functions
const saveToFirestore = async (collectionName, data, docId = null) => {
  try {
    if (!firebaseConnected) {
      console.warn('Firebase not connected. Data saved to localStorage only.');
      return null;
    }

    const timestamp = new Date().toISOString();
    const dataWithTimestamp = {
      ...data,
      createdAt: timestamp,
      updatedAt: timestamp
    };

    let docRef;
    if (docId) {
      // Update existing document
      docRef = doc(db, collectionName, docId);
      await updateDoc(docRef, { ...dataWithTimestamp, updatedAt: timestamp });
      console.log(`‚úÖ Updated document in ${collectionName}:`, docId);
    } else {
      // Create new document
      docRef = await addDoc(collection(db, collectionName), dataWithTimestamp);
      console.log(`‚úÖ Saved to Firestore collection ${collectionName}:`, docRef.id);
    }
    
    return docRef.id;
  } catch (error) {
    console.error(`‚ùå Error saving to Firestore collection ${collectionName}:`, error);
    return null;
  }
};

const getFromFirestore = async (collectionName) => {
  try {
    if (!firebaseConnected) {
      console.warn('Firebase not connected. Cannot retrieve data from Firestore.');
      return [];
    }

    const querySnapshot = await getDocs(collection(db, collectionName));
    const data = [];
    querySnapshot.forEach((doc) => {
      data.push({ id: doc.id, ...doc.data() });
    });
    
    console.log(`‚úÖ Retrieved ${data.length} documents from ${collectionName}`);
    return data;
  } catch (error) {
    console.error(`‚ùå Error getting data from Firestore collection ${collectionName}:`, error);
    return [];
  }
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô collection
const clearFirestoreCollection = async (collectionName) => {
  try {
    if (!firebaseConnected) {
      console.warn('Firebase not connected. Cannot clear collection.');
      return false;
    }

    console.log(`üóëÔ∏è Clearing all documents from ${collectionName}...`);
    const querySnapshot = await getDocs(collection(db, collectionName));
    
    if (querySnapshot.empty) {
      console.log(`‚úÖ Collection ${collectionName} is already empty`);
      return true;
    }

    // ‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô collection
    const deletePromises = [];
    querySnapshot.forEach((document) => {
      deletePromises.push(deleteDoc(doc(db, collectionName, document.id)));
    });

    await Promise.all(deletePromises);
    console.log(`‚úÖ Cleared ${querySnapshot.size} documents from ${collectionName}`);
    return true;
  } catch (error) {
    console.error(`‚ùå Error clearing collection ${collectionName}:`, error);
    return false;
  }
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å collection
const clearAllFirestoreData = async () => {
  try {
    console.log('üóëÔ∏è Clearing all data from Firestore...');
    const collections = [
      'kpi_reports',
      'consumables_reports', 
      'ot_reports',
      'leave_reports',
      'accident_reports',
      'workload_reports'
    ];

    const clearPromises = collections.map(collectionName => 
      clearFirestoreCollection(collectionName)
    );

    const results = await Promise.all(clearPromises);
    const allSuccess = results.every(result => result === true);
    
    if (allSuccess) {
      console.log('üéâ Successfully cleared all data from Firestore');
      return true;
    } else {
      console.warn('‚ö†Ô∏è Some collections could not be cleared');
      return false;
    }
  } catch (error) {
    console.error('‚ùå Error clearing all Firestore data:', error);
    return false;
  }
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Firestore
const loadLatestDataFromFirestore = async (stateSetters) => {
  try {
    console.log('üîÑ Loading latest data from Firestore...');
    
    const {
      setKpis, setChartData, setTableRows,
      setConsumablesTableData, setConsumablesKpis, setConsumablesChartData,
      setOtTableData, setOtKpis, setOtChartData,
      setLeaveTableData, setLeaveKpis, setLeaveChartData,
      setAccidentTableData, setAccidentKpis, setAccidentChartData,
      setWorkloadReportData
    } = stateSetters;
    
    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• KPI ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const kpiData = await getFromFirestore('kpi_reports');
    if (kpiData.length > 0) {
      const latestKpi = kpiData.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt))[0];
      if (latestKpi.data) {
        setKpis(latestKpi.data.kpis || []);
        setChartData(latestKpi.data.chartData || []);
        setTableRows(latestKpi.data.tableRows || []);
        console.log('‚úÖ Loaded latest KPI data');
      }
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Consumables ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const consumablesData = await getFromFirestore('consumables_reports');
    if (consumablesData.length > 0) {
      const latestConsumables = consumablesData.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt))[0];
      if (latestConsumables.data) {
        setConsumablesTableData(latestConsumables.data.tableData || []);
        setConsumablesKpis(latestConsumables.data.kpis || []);
        setConsumablesChartData(latestConsumables.data.chartData || []);
        console.log('‚úÖ Loaded latest Consumables data');
      }
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• OT ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const otData = await getFromFirestore('ot_reports');
    if (otData.length > 0) {
      const latestOt = otData.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt))[0];
      if (latestOt.data) {
        setOtTableData(latestOt.data.tableData || []);
        setOtKpis(latestOt.data.kpis || []);
        setOtChartData(latestOt.data.chartData || []);
        console.log('‚úÖ Loaded latest OT data');
      }
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Leave ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const leaveData = await getFromFirestore('leave_reports');
    if (leaveData.length > 0) {
      const latestLeave = leaveData.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt))[0];
      if (latestLeave.data) {
        setLeaveTableData(latestLeave.data.tableData || []);
        setLeaveKpis(latestLeave.data.kpis || []);
        setLeaveChartData(latestLeave.data.chartData || []);
        console.log('‚úÖ Loaded latest Leave data');
      }
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Accident ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const accidentData = await getFromFirestore('accident_reports');
    if (accidentData.length > 0) {
      const latestAccident = accidentData.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt))[0];
      if (latestAccident.data) {
        setAccidentTableData(latestAccident.data.tableData || []);
        setAccidentKpis(latestAccident.data.kpis || []);
        setAccidentChartData(latestAccident.data.chartData || []);
        console.log('‚úÖ Loaded latest Accident data');
      }
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Workload ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const workloadData = await getFromFirestore('workload_reports');
    if (workloadData.length > 0) {
      const latestWorkload = workloadData.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt))[0];
      if (latestWorkload.data) {
        setWorkloadReportData(latestWorkload.data.data || []);
        console.log('‚úÖ Loaded latest Workload data');
      }
    }

    console.log('üéâ Finished loading all latest data from Firestore');
    return true;
  } catch (error) {
    console.error('‚ùå Error loading data from Firestore:', error);
    return false;
  }
};


// ===================================================
// START: i18n/translations.ts
// ===================================================
const translations = {
    en: {
        // Sidebar
        'kpiReport': 'KPI Report',
        'consumablesReport': 'Consumables Report',
        'otReport': 'OT Report',
        'leaveReport': 'Leave Report',
        'accidentReport': 'Accident Report',
        'workloadReport': 'Workload Report',
        'reports': 'Reports',
        'documents': 'Documents',
        'settings': 'Settings',
        'helpCenter': 'Help Center',
        'analytics': 'Analytics',
        // Header
        'search': 'Search...',
        'uploadKpiData': 'Upload KPI Data',
        'shareReport': 'Share Report',
        'loadReport': 'Load Report',
        'userName': 'Jane Doe',
        'userRole': 'Admin',
        // KPI Card
        'vsLastMonth': 'vs last month',
        // Main Chart
        'kpiProgressOverview': 'KPI Progress Overview',
        // Data Table
        'kpiDetails': 'KPI Details',
        'searchDetails': 'Search details...',
        'kpi': 'KPI',
        'target': 'Target',
        'score': 'Score',
        'result': 'Result',
        'noResultsFound': 'No results found.',
        // Consumables Report
        'uploadExcel': 'Upload Excel',
        'noDataLoaded': 'No Data Loaded',
        'noDataLoadedMessageConsumables': 'Please upload an Excel file using the button above to view the report.',
        'monthlyConsumablesCost': 'Monthly Consumables Cost',
        'top5FrequentItems': 'Top 5 Frequent Items',
        'frequency': 'Frequency',
        'totalCost': 'Total Cost',
        'costByDepartment': 'Cost by Department',
        'department': 'Department',
        'recentTransactions': 'Recent Transactions',
        'searchTransactions': 'Search transactions...',
        // OT Report
        'noDataLoadedMessageOT': 'Please upload an Excel file using the button above to view the OT report.',
        'monthlyOvertimeHours': 'Monthly Overtime Hours',
        'top10EmployeesByOT': 'Top 10 Employees by OT',
        'name': 'Name',
        'totalHours': 'Total Hours',
        'top10DepartmentsByOT': 'Top 10 Departments by OT',
        'employeeOTDetails': 'Employee OT Details',
        'searchEmployees': 'Search employees...',
        // Leave Report
        'noDataLoadedMessageLeave': 'Please upload an Excel file using the button above to view the Leave report.',
        'monthlyLeaveDays': 'Monthly Leave Days',
        'top10LeaveEmployees': 'Top 10 Employees by Leave',
        'days': 'Days',
        'top5LeaveTypes': 'Top 5 Leave Types',
        'leaveType': 'Leave Type',
        'top5LeaveDepartments': 'Top 5 Departments by Leave',
        'employeeLeaveDetails': 'Employee Leave Details',
        // Accident Report
        'noDataLoadedMessageAccident': 'Please upload an Excel file using the button above to view the Accident report.',
        'accidentsByDepartment': 'Accidents by Department',
        'accidentDetails': 'Accident Details',
        'searchAccidents': 'Search accidents...',
        // Workload Report
        'workloadByProduct': 'Workload by Product (Ton/Person/Hr.)',
        'avgWorkloadRaw': 'Avg. Ton/Hr (Raw Material)',
        'avgWorkloadCoil': 'Avg. Ton/Hr (Coil)',
        'avgWorkloadFilm': 'Avg. Ton/Hr (Film&Scrap)',
        'workloadDetails': 'Workload Details',
        'product': 'Product',
        'description': 'Description',
        'unit': 'Unit',
        // Placeholder
        'underConstruction': 'This page is under construction.',
        // General
        'pass': 'PASS',
        'inProgress': 'In Progress'
    },
    th: {
        // Sidebar
        'kpiReport': '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô KPI',
        'consumablesReport': '‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á',
        'otReport': '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô OT',
        'leaveReport': '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤',
        'accidentReport': '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏',
        'workloadReport': '‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô',
        'reports': '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
        'documents': '‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',
        'settings': '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤',
        'helpCenter': '‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠',
        'analytics': '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå',
        // Header
        'search': '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...',
        'uploadKpiData': '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• KPI',
        'shareReport': '‡πÅ‡∏ä‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô',
        'loadReport': '‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô',
        'userName': '‡πÄ‡∏à‡∏ô ‡πÇ‡∏î',
        'userRole': '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö',
        // KPI Card
        'vsLastMonth': '‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß',
        // Main Chart
        'kpiProgressOverview': '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ KPI',
        // Data Table
        'kpiDetails': '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î KPI',
        'searchDetails': '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î...',
        'kpi': 'KPI',
        'target': '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢',
        'score': '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô',
        'result': '‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå',
        'noResultsFound': '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå',
        // Consumables Report
        'uploadExcel': '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Excel',
        'noDataLoaded': '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
        'noDataLoadedMessageConsumables': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô',
        'monthlyConsumablesCost': '‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
        'top5FrequentItems': '5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î',
        'frequency': '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà',
        'totalCost': '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°',
        'costByDepartment': '‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å',
        'department': '‡πÅ‡∏ú‡∏ô‡∏Å',
        'recentTransactions': '‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',
        'searchTransactions': '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°...',
        // OT Report
        'noDataLoadedMessageOT': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô OT',
        'monthlyOvertimeHours': '‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏•‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
        'top10EmployeesByOT': '10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ OT ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î',
        'name': '‡∏ä‡∏∑‡πà‡∏≠',
        'totalHours': '‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏£‡∏ß‡∏°',
        'top10DepartmentsByOT': '10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏ó‡∏µ‡πà‡∏ó‡∏≥ OT ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î',
        'employeeOTDetails': '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î OT ‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
        'searchEmployees': '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô...',
        // Leave Report
        'noDataLoadedMessageLeave': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤',
        'monthlyLeaveDays': '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
        'top10LeaveEmployees': '10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î',
        'days': '‡∏ß‡∏±‡∏ô',
        'top5LeaveTypes': '5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤',
        'leaveType': '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤',
        'top5LeaveDepartments': '5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î',
        'employeeLeaveDetails': '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
        // Accident Report
        'noDataLoadedMessageAccident': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏',
        'accidentsByDepartment': '‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡∏ï‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô',
        'accidentDetails': '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏',
        'searchAccidents': '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏...',
        // Workload Report
        'workloadByProduct': '‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå (‡∏ï‡∏±‡∏ô/‡∏Ñ‡∏ô/‡∏ä‡∏°.)',
        'avgWorkloadRaw': '‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ Ton/Hr (Raw Material)',
        'avgWorkloadCoil': '‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ Ton/Hr (Coil)',
        'avgWorkloadFilm': '‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ Ton/Hr (Film&Scrap)',
        'workloadDetails': '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô',
        'product': '‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå',
        'description': '‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢',
        'unit': '‡∏´‡∏ô‡πà‡∏ß‡∏¢',
        // Placeholder
        'underConstruction': '‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤',
        // General
        'pass': '‡∏ú‡πà‡∏≤‡∏ô',
        'inProgress': '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà'
    }
};

const getInitialState = (key, defaultValue) => {
    try {
        const storedValue = localStorage.getItem(key);
        if (storedValue) {
            return JSON.parse(storedValue);
        }
    } catch (error) {
        console.error(`Error reading "${key}" from localStorage`, error);
        localStorage.removeItem(key);
    }
    return defaultValue;
};

const LanguageContext = createContext(null);
const LanguageProvider = ({ children }) => {
    const [language, setLanguage] = useState(getInitialState('language', 'en'));
    useEffect(() => {
        localStorage.setItem('language', JSON.stringify(language));
        document.documentElement.style.fontFamily = language === 'th' ? "'Sarabun', sans-serif" : "'Inter', sans-serif";
    }, [language]);
    const toggleLanguage = () => {
        setLanguage(lang => (lang === 'en' ? 'th' : 'en'));
    };
    const t = (key) => {
        return translations[language][key] || key;
    };
    return (
        <LanguageContext.Provider value={{ language, toggleLanguage, t }}>
            {children}
        </LanguageContext.Provider>
    );
};
const useTranslation = () => useContext(LanguageContext);
// ===================================================
// END: i18n/translations.ts
// ===================================================


// ===================================================
// START: components/icons/Icons.tsx
// ===================================================
const Bars3Icon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
    </svg>
);
const XMarkIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M6 18 18 6M6 6l12 12" />
    </svg>
);
const ArchiveBoxIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z" />
    </svg>
);
const BuildingOfficeIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6h1.5m-1.5 3h1.5m-1.5 3h1.5M6.75 21v-2.25a2.25 2.25 0 0 1 2.25-2.25h6a2.25 2.25 0 0 1 2.25 2.25V21m-2.25-18-2.25.002" />
    </svg>
);
const ArrowTrendingDownIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" />
  </svg>
);
const ArrowTrendingUpIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 6 9 12.75l4.286-4.286a11.948 11.948 0 0 1 5.814 5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" />
  </svg>
);
const BellIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
  </svg>
);
const ChartBarIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
  </svg>
);
const CurrencyDollarIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
  </svg>
);
const MagnifyingGlassIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
  </svg>
);
const MinusIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M5 12h14" />
    </svg>
);
const ShoppingCartIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c.51 0 .962-.343 1.087-.835l1.838-5.513a1.875 1.875 0 0 0-1.097-2.288H5.64M7.5 14.25 5.106 5.106M15 21a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm0 0h-5.64m5.64 0-1.03-4.125M9 21a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" />
  </svg>
);
const UsersIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m-7.5-2.226A6.668 6.668 0 0 0 12 14.25a6.668 6.668 0 0 0-3.468-.985m7.5 0a9.094 9.094 0 0 1 3.741-.479 3 3 0 0 1-4.682-2.72M12 12.75a3 3 0 1 1 0-6 3 3 0 0 1 0 6Zm0 0a9.094 9.094 0 0 0-3.741-.479 3 3 0 0 0-4.682-2.72M6.344 18.72a9.094 9.094 0 0 1-3.741-.479 3 3 0 0 1 4.682-2.72M12 12.75a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
  </svg>
);
const UserGroupIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m-7.5-2.226A6.668 6.668 0 0 0 12 14.25a6.668 6.668 0 0 0-3.468-.985m7.5 0a9.094 9.094 0 0 1 3.741-.479 3 3 0 0 1-4.682-2.72m-12 2.226A6.668 6.668 0 0 1 12 14.25a6.668 6.668 0 0 1 3.468-.985m-7.5 0a9.094 9.094 0 0 0-3.741-.479 3 3 0 0 0 4.682-2.72M9 12.75a3 3 0 1 1 0-6 3 3 0 0 1 0 6Zm0 0a9.094 9.094 0 0 1-3.741-.479 3 3 0 0 1-4.682-2.72m0 0a9.094 9.094 0 0 0 3.741.479 3 3 0 0 0-4.682 2.72m7.5-2.226A6.668 6.668 0 0 0 12 14.25a6.668 6.668 0 0 0-3.468-.985" />
  </svg>
);
const HomeIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" />
    </svg>
);
const ChartPieIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z" />
        <path strokeLinecap="round" strokeLinejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z" />
    </svg>
);
const DocumentTextIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
    </svg>
);
const Cog6ToothIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.438.995s.145.755.438.995l1.003.827c.424.35.534.954.26 1.431l-1.296 2.247a1.125 1.125 0 0 1-1.37.49l-1.217-.456c-.355-.133-.75-.072-1.075.124a6.57 6.57 0 0 1-.22.127c-.332.183-.582.495-.645.87l-.213 1.281c-.09.543-.56.94-1.11.94h-2.593c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.063-.374-.313-.686-.645-.87a6.52 6.52 0 0 1-.22-.127c-.324-.196-.72-.257-1.075-.124l-1.217.456a1.125 1.125 0 0 1-1.37-.49l-1.296-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.437-.995s-.145-.755-.437-.995l-1.004-.827a1.125 1.125 0 0 1-.26-1.431l1.296-2.247a1.125 1.125 0 0 1 1.37-.49l1.217.456c.355.133.75.072 1.075-.124.072-.044.146-.087.22-.127.332-.183.582-.495.645-.87l.213-1.281Z" />
        <path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
    </svg>
);
const QuestionMarkCircleIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
    </svg>
);
const BoltIcon = (props) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
    <path strokeLinecap="round" strokeLinejoin="round" d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z" />
  </svg>
);
const ArrowUpTrayIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
    </svg>
);
const ClipboardDocumentListIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 4.8424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75c0-.231-.035-.454-.1-.664M18.75 19.5H5.25A2.25 2.25 0 0 1 3 17.25V9h16.5v8.25c0 1.242-1.008 2.25-2.25 2.25Z" />
    </svg>
);
const ClockIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
    </svg>
);
const CalendarDaysIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0h18M-4.5 12h22.5" />
    </svg>
);
const ClipboardDocumentCheckIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 0 1 9 9v.375M10.125 2.25A3.375 3.375 0 0 1 13.5 5.625v1.5c0 .621.504 1.125 1.125 1.125h1.5a3.375 3.375 0 0 1 3.375 3.375M9 15l2.25 2.25L15 12" />
    </svg>
);
const ExclamationTriangleIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
    </svg>
);
const SunIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
    </svg>
);
const MoonIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" />
    </svg>
);
const ShareIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-4.5 0V6m0 0h4.5m-4.5 0-6 6" />
    </svg>
);
const ArrowDownTrayIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
    </svg>
);
const ArrowPathIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
    </svg>
);
const TrashIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
    </svg>
);
const CubeIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
    </svg>
);
const SparklesIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z" />
    </svg>
);
const ShieldCheckIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z" />
    </svg>
);
const AcademicCapIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" />
    </svg>
);
const ForkliftIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M2 18h2m0 0a2 2 0 1 0 4 0m-4 0V8a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v10m0 0a2 2 0 1 0 4 0m-4 0h4m-4-10V6a1 1 0 0 1 1-1h4v3m-5 2h5m0 0v8m0-8h2l1 1v7" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M8 5V3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2" />
    </svg>
);
const LeafIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M12 2C8.5 2 5.5 4.5 4 8c-1 2.5-1 5.5 1 8 1.5 1.5 3.5 2 5.5 2 3 0 5.5-2 6.5-5 1-3 0-6-2-8.5C14 3.5 13 2.5 12 2z" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M12 2c1.5 2 2.5 4.5 2 7.5-.5 3-2.5 5.5-5 6.5" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M8 10c1 0 2 .5 2.5 1.5" />
    </svg>
);
const MedicalBagIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M12 2L8 6v2h8V6l-4-4z" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M6 8h12v12a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V8z" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M12 11v6m-3-3h6" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M9 4h6v2H9V4z" />
    </svg>
);
const BookIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M4 6h16v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6z" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M4 6V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v2" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M8 10h8m-8 4h6" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M12 2v4" />
    </svg>
);
const StairsIcon = (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
      <path strokeLinecap="round" strokeLinejoin="round" d="M3 21h4v-4h4v-4h4v-4h4V5h2" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M12 16c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M12 16v3l-1 1-1-1v-2l1-1h1z" />
      <path strokeLinecap="round" strokeLinejoin="round" d="M10 12l2-2 2 2" />
    </svg>
);
// ===================================================
// END: components/icons/Icons.tsx
// ===================================================


// ===================================================
// START: constants.tsx
// ===================================================
const kpiData = [
  {
    title: 'Total Revenue',
    value: '$48,329.50',
    trend: '+12.5%',
    trendDirection: 'up',
    icon: 'CurrencyDollarIcon',
    color: 'text-brand-success',
  },
  {
    title: 'Total Sales',
    value: '12,834',
    trend: '+8.2%',
    trendDirection: 'up',
    icon: 'ShoppingCartIcon',
    color: 'text-brand-primary',
  },
  {
    title: 'New Customers',
    value: '849',
    trend: '-1.8%',
    trendDirection: 'down',
    icon: 'UsersIcon',
    color: 'text-brand-warning',
  },
  {
    title: 'Conversion Rate',
    value: '4.75%',
    trend: '+0.5%',
    trendDirection: 'up',
    icon: 'ChartBarIcon',
    color: 'text-brand-secondary',
  },
];
const mainChartData = [
    { name: 'Jan', value: 2400 },
    { name: 'Feb', value: 3100 },
    { name: 'Mar', value: 2900 },
    { name: 'Apr', value: 4200 },
    { name: 'May', value: 3800 },
    { name: 'Jun', value: 5100 },
    { name: 'Jul', value: 4900 },
    { name: 'Aug', value: 5800 },
    { name: 'Sep', value: 5300 },
    { name: 'Oct', value: 6400 },
    { name: 'Nov', value: 7200 },
    { name: 'Dec', value: 8100 },
];
const tableData = [
  {
    kpi: { title: 'Premium Wireless Headphones', measurement: 'Electronics' },
    target: '1500 sales',
    score: '1250',
    result: 'In Progress',
  },
  {
    kpi: { title: 'Organic Matcha Green Tea', measurement: 'Groceries' },
    target: '1000 sales',
    score: '980',
    result: 'In Progress',
  },
  {
    kpi: { title: 'Smart Fitness Tracker', measurement: 'Wearables' },
    target: '800 sales',
    score: '820',
    result: 'PASS',
  },
  {
    kpi: { title: 'Ergonomic Office Chair', measurement: 'Furniture' },
    target: '500 sales',
    score: '450',
    result: 'In Progress',
  },
    {
    kpi: { title: 'Cold Brew Coffee Maker', measurement: 'Home Goods' },
    target: '300 sales',
    score: '310',
    result: 'PASS',
  },
];
const parseValue = (val) => {
    if (val === '-' || val === '#DIV/0!' || val == null || String(val).trim() === '') return null;
    if (typeof val === 'number') return val;
    if (typeof val === 'string') {
        const num = parseFloat(val.replace(/,/g, ''));
        return isNaN(num) ? null : num;
    }
    return null;
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤ Score ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
const formatScoreAsPercentage = (score) => {
    if (!score || score === 'N/A' || score === '-') return score;
    
    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÉ‡∏´‡πâ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
    const numericScore = parseFloat(String(score).replace(/[^0-9.-]/g, ''));
    if (!isNaN(numericScore)) {
        // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 1 ‡πÉ‡∏´‡πâ‡∏Ñ‡∏π‡∏ì 100 (‡πÄ‡∏ä‡πà‡∏ô 0.85 -> 85%)
        // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° (‡πÄ‡∏ä‡πà‡∏ô 85 -> 85%)
        const percentage = numericScore <= 1 ? numericScore * 100 : numericScore;
        return `${percentage.toFixed(1)}%`;
    }
    
    return score;
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤ Score ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö KPI Details table
const formatScoreForKpiDetails = (score, kpiTitle) => {
    if (!score || score === 'N/A' || score === '-') return score;
    
    const titleLower = String(kpiTitle).toLowerCase();
    
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Availability of forklifts ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô "‡∏ß‡∏±‡∏ô"
    if (titleLower.includes('availability') && titleLower.includes('forklift') || 
        titleLower.includes('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡∏¢‡∏Å') || 
        titleLower.includes('avaliability')) {
        
        const numericScore = parseFloat(String(score).replace(/[^0-9.-]/g, ''));
        if (!isNaN(numericScore)) {
            return `${numericScore} ‡∏ß‡∏±‡∏ô`;
        }
        return score;
    }
    
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö KPI ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÄ‡∏î‡∏¥‡∏°
    return formatScoreAsPercentage(score);
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤ Score ‡∏Ç‡∏≠‡∏á KPI ‡πÄ‡∏â‡∏û‡∏≤‡∏∞
const modifySpecificKpiScore = (title, originalScore) => {
    if (!originalScore || originalScore === 'N/A' || originalScore === '-') {
        return originalScore;
    }
    
    const titleLower = String(title).toLowerCase();
    
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Availability of forklifts ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ (‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå)
    if (titleLower.includes('availability') && titleLower.includes('forklift') || 
        titleLower.includes('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡∏¢‡∏Å') || 
        titleLower.includes('avaliability')) {
        const numericScore = parseFloat(String(originalScore).replace(/[^0-9.-]/g, ''));
        if (!isNaN(numericScore)) {
            return numericScore.toString();
        }
        return originalScore;
    }
    
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö KPI ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
    return formatScoreAsPercentage(originalScore);
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö KPI ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß
const getKpiIcon = (title) => {
    const titleLower = String(title).toLowerCase();
    
    // KPI #1: Availability of forklifts - ‡∏£‡∏ñ‡πÇ‡∏ü‡∏•‡πå‡∏Ñ‡∏•‡∏¥‡∏ü‡∏ó‡πå / ‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á
    if (titleLower.includes('availability') && titleLower.includes('forklift') || 
        titleLower.includes('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡∏¢‡∏Å') || 
        titleLower.includes('avaliability')) {
        return 'CubeIcon'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á (‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á)
    }
    
    // KPI #2: Carbon Emission - ‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°
    if (titleLower.includes('initiative') && titleLower.includes('carbon') || 
        titleLower.includes('‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏Å‡πä‡∏≤‡∏ã‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô') ||
        titleLower.includes('carbon') && titleLower.includes('emission')) {
        return 'SparklesIcon'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Sparkles (‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏∞‡∏≠‡∏≤‡∏î/‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°)
    }
    
    // KPI #3: IFR accident rate - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
    if (titleLower.includes('‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏') && titleLower.includes('ifr') || 
        titleLower.includes('ifr') && titleLower.includes('2024') ||
        titleLower.includes('accident') && titleLower.includes('ifr')) {
        return 'ShieldCheckIcon'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏•‡πà‡∏Å‡∏£‡∏∞‡∏ö‡∏ö (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
    }
    
    // KPI #4: Lean management - ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á
    if (titleLower.includes('lean') && titleLower.includes('management') || 
        titleLower.includes('‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤') ||
        titleLower.includes('lean mamagement system')) {
        return 'ChartPieIcon'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏° (‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£/‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô)
    }
    
    // KPI #5: IDP Implementation - ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï/‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤
    if (titleLower.includes('idp') && titleLower.includes('implementation') || 
        titleLower.includes('idp implementation succeed g4-g7') ||
        titleLower.includes('‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å')) {
        return 'AcademicCapIcon'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏ß‡∏Å‡∏ö‡∏±‡∏ì‡∏ë‡∏¥‡∏ï (‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤/‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ)
    }
    
    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö KPI ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    return 'ChartBarIcon';
};

const workloadData = [
    {
        product: 'Raw Material',
        rows: [
            { description: 'Weight : GR_Out', isSubRow: true, unit: 'Ton', values: [73, 61, 212, 61, 424, 118, 91, 204, null, null, null, null], average: 155.5, min: 61, max: 424 },
            { description: 'Weight : GI_Out', isSubRow: true, unit: 'Ton', values: [81, 94, 47, 31, 67, 68, 83, 50, null, null, null, null], average: 65.13, min: 31, max: 94 },
            { description: 'Weight : GR_In', isSubRow: true, unit: 'Ton', values: [4941, 4302, 5161, 2669, 3727, 3898, 4514, 4176, null, null, null, null], average: 4173.5, min: 2669, max: 5161 },
            { description: 'Weight : GI_In', isSubRow: true, unit: 'Ton', values: [5461, 5328, 5283, 3978, 4412, 4333, 5247, 4736, null, null, null, null], average: 4847.25, min: 3978, max: 5461 },
            { description: 'Sum : Weight', isSubRow: false, unit: 'Ton', values: [10556, 9785, 10703, 6739, 8630, 8417, 9935, 9166, 0, 0, 0, 0], average: 6721, min: 0, max: 10703 },
            { description: 'Manpower', isSubRow: false, unit: 'Person', values: [14, 14, 14, 14, 14, 14, 14, 14, null, null, null, null], average: 14, min: 14, max: 14 },
            { description: 'Workday', isSubRow: false, unit: 'Day', values: [26, 24, 25, 22, 24, 24, 26, 25, null, null, null, null], average: 24.5, min: 22, max: 26 },
            { description: 'Working Hours', isSubRow: false, unit: 'Hours', values: [2912, 2688, 2800, 2464, 2688, 2688, 2912, 2800, 0, 0, 0, 0], average: 1995.64, min: 0, max: 2912 },
            { description: 'OT', isSubRow: false, unit: 'Hours', values: [778.3, 743, 818, 615, 695, 710, 699, 736, null, null, null, null], average: 724.29, min: 615, max: 818 },
            { description: 'Sum : Hours', isSubRow: false, unit: 'Hours', values: [3690.3, 3431, 3618, 3079, 3383, 3398, 3611, 3536, 0, 0, 0, 0], average: 2522.39, min: 0, max: 3690.3 },
        ]
    },
    {
        product: 'Ton/Person/Hr.',
        isSubProduct: true,
        rows: [
            { description: 'Receipt_Out', isSubRow: true, unit: '', values: [0.02, 0.02, 0.06, 0.02, 0.13, 0.03, 0.03, 0.06, null, null, null, null], average: null, min: null, max: null },
            { description: 'Issue_Out', isSubRow: true, unit: '', values: [0.02, 0.03, 0.01, 0.01, 0.02, 0.02, 0.02, 0.01, null, null, null, null], average: null, min: null, max: null },
            { description: 'Receipt_In', isSubRow: true, unit: '', values: [1.34, 1.25, 1.43, 0.87, 1.1, 1.15, 1.25, 1.18, null, null, null, null], average: null, min: null, max: null },
            { description: 'Issue_In', isSubRow: true, unit: '', values: [1.48, 1.55, 1.46, 1.29, 1.3, 1.28, 1.45, 1.34, null, null, null, null], average: null, min: null, max: null },
            { description: 'Sum', isSubRow: false, unit: '', values: [2.86, 2.85, 2.96, 2.19, 2.55, 2.48, 2.75, 2.59, null, null, null, null], average: null, min: null, max: null }
        ]
    },
    {
        product: 'Coil',
        rows: [
            { description: 'Weight : GR_Out', isSubRow: true, unit: 'Ton', values: [52759.08, 54903.78, 52647.99, 51072.26, 46240.49, 49378.8, 48592.98, 64070.97, null, null, null, null], average: 52458.29, min: 46240.49, max: 64070.97 },
            { description: 'Weight : GI_Out', isSubRow: true, unit: 'Ton', values: [1180.53, 3168.55, 1008.65, 691.96, 695.07, 420.98, 229.19, 351.44, null, null, null, null], average: 968.3, min: 229.19, max: 3168.55 },
            { description: 'Weight : GR_In', isSubRow: true, unit: 'Ton', values: [45.68, 83.97, 100.75, 33.87, 57.1, 123.29, 90.96, 89.86, null, null, null, null], average: 78.19, min: 33.87, max: 123.29 },
            { description: 'Weight : GI_In', isSubRow: true, unit: 'Ton', values: [52136.43, 58890.62, 57909.8, 45454.52, 49189.23, 53805.07, 54331.62, 54650.72, null, null, null, null], average: 53296, min: 45454.52, max: 58890.62 },
            { description: 'Sum : Weight', isSubRow: false, unit: 'Ton', values: [106121.72, 117046.92, 111667.19, 97252.61, 96181.89, 103728.14, 103244.75, 119162.99, 0, 0, 0, 0], average: 77673.29, min: 0, max: 119162.99 },
            { description: 'Manpower', isSubRow: false, unit: 'People', values: [21, 20, 20, 20, 20, 20, 20, 19, null, null, null, null], average: 20, min: 19, max: 21 },
            { description: 'Workday', isSubRow: false, unit: 'Day', values: [26, 24, 25, 22, 24, 24, 26, 25, null, null, null, null], average: 24.5, min: 22, max: 26 },
            { description: 'Working Hours', isSubRow: false, unit: 'Hours', values: [4368, 3840, 4000, 3520, 3840, 3840, 4160, 3800, 0, 0, 0, 0], average: 2851.64, min: 0, max: 4368 },
            { description: 'OT', isSubRow: false, unit: 'Hours', values: [1124.55, 922, 945, 868, 1014, 1122, 1043.55, 940, null, null, null, null], average: 997.39, min: 868, max: 1124.55 },
            { description: 'Sum : Hours', isSubRow: false, unit: 'Hours', values: [5492.55, 4762, 4945, 4388, 4854, 4962, 5203.55, 4740, 0, 0, 0, 0], average: 3577.01, min: 0, max: 5492.55 },
        ]
    },
    {
        product: 'Ton/Person/Hr.',
        isSubProduct: true,
        rows: [
            { description: 'Receipt_Out', isSubRow: true, unit: '', values: [9.61, 11.53, 10.65, 11.64, 9.53, 9.95, 9.34, 13.52, null, null, null, null], average: null, min: null, max: null },
            { description: 'Issue_Out', isSubRow: true, unit: '', values: [0.21, 0.67, 0.2, 0.16, 0.14, 0.08, 0.04, 0.07, null, null, null, null], average: null, min: null, max: null },
            { description: 'Receipt_In', isSubRow: true, unit: '', values: [0.01, 0.02, 0.02, 0.01, 0.01, 0.02, 0.02, 0.02, null, null, null, null], average: null, min: null, max: null },
            { description: 'Issue_In', isSubRow: true, unit: '', values: [9.49, 12.37, 11.71, 10.36, 10.13, 10.84, 10.44, 11.53, null, null, null, null], average: null, min: null, max: null },
            { description: 'Sum', isSubRow: false, unit: '', values: [19.32, 24.58, 22.58, 22.16, 19.81, 20.9, 19.84, 25.14, null, null, null, null], average: null, min: null, max: null }
        ]
    },
    {
        product: 'Film&Scrap',
        rows: [
            { description: 'Weight : GR_Out', isSubRow: true, unit: 'Ton', values: [null, 554, 2987, 401, null, null, null, null, null, null, null, null], average: 492.75, min: 0, max: 2987 },
            { description: 'Weight : GI_Out', isSubRow: true, unit: 'Ton', values: [5867.25, 5099.27, 5516.73, 3934.92, 4400.15, 4359.65, 4767.1, 6146.9, null, null, null, null], average: 5011.5, min: 3934.92, max: 6146.9 },
            { description: 'Weight : GR_In', isSubRow: true, unit: 'Ton', values: [31864.21, 34016.91, 30480.65, 29577.71, 31210.2, 33778.1, 35968.9, 33475.86, null, null, null, null], average: 32546.57, min: 29577.71, max: 35968.9 },
            { description: 'Weight : GI_In', isSubRow: true, unit: 'Ton', values: [27612.99, 28365.85, 26887.14, 25465.35, 27796.17, 31288.83, 33208.52, 27706.66, null, null, null, null], average: 28541.44, min: 25465.35, max: 33208.52 },
            { description: 'Sum : Weight', isSubRow: false, unit: 'Ton', values: [65344.45, 68036.03, 65871.52, 59378.98, 63406.52, 69426.58, 73944.52, 67329.42, 0, 0, 0, 0], average: 48430.73, min: 0, max: 73944.52 },
            { description: 'Manpower', isSubRow: false, unit: 'Person', values: [27, 26, 25, 26, 26, 26, 27, 27, null, null, null, null], average: 26.25, min: 25, max: 27 },
            { description: 'Workday', isSubRow: false, unit: 'Day', values: [26, 24, 25, 22, 24, 24, 26, 25, null, null, null, null], average: 24.5, min: 22, max: 26 },
            { description: 'Working Hours', isSubRow: false, unit: 'Hours', values: [5616, 4992, 5000, 4576, 4992, 4992, 5616, 5400, 0, 0, 0, 0], average: 3744, min: 0, max: 5616 },
            { description: 'OT', isSubRow: false, unit: 'Hours', values: [1882, 1485, 1777, 1393, 1738, 1898, 1921.15, 1727, null, null, null, null], average: 1727.64, min: 1393, max: 1921.15 },
            { description: 'Sum : Hours', isSubRow: false, unit: 'Hours', values: [7498, 6477, 6777, 5969, 6730, 6890, 7537.15, 7127, 0, 0, 0, 0], average: 5000.47, min: 0, max: 7537.15 },
        ]
    },
     {
        product: 'Ton/Person/Hr.',
        isSubProduct: true,
        rows: [
            { description: 'Receipt_Out', isSubRow: true, unit: '', values: [0, 0.09, 0.44, 0.07, 0, 0, 0, 0, null, null, null, null], average: null, min: null, max: null },
            { description: 'Issue_Out', isSubRow: true, unit: '', values: [0.78, 0.79, 0.81, 0.66, 0.65, 0.63, 0.63, 0.86, null, null, null, null], average: null, min: null, max: null },
            { description: 'Receipt_In', isSubRow: true, unit: '', values: [4.25, 5.25, 4.5, 4.96, 4.64, 4.9, 4.77, 4.7, null, null, null, null], average: null, min: null, max: null },
            { description: 'Issue_In', isSubRow: true, unit: '', values: [3.68, 4.38, 3.97, 4.27, 4.13, 4.54, 4.41, 3.89, null, null, null, null], average: null, min: null, max: null },
            { description: 'Sum', isSubRow: false, unit: '', values: [8.71, 10.5, 9.72, 9.95, 9.42, 10.08, 9.81, 9.45, null, null, null, null], average: null, min: null, max: null }
        ]
    }
];
// ===================================================
// END: constants.tsx
// ===================================================


// ===================================================
// START: MOCK BACKEND
// ===================================================
const DB_STORAGE_KEY = 'kpiDashboardDatabase';

const defaultDatabase = {
  kpiData: {
    kpis: kpiData,
    chartData: mainChartData,
    tableRows: tableData,
  },
  consumablesData: {
    tableData: [],
    kpis: [],
    chartData: [],
  },
  otData: {
    tableData: [],
    kpis: [],
    chartData: [],
  },
  leaveData: {
    tableData: [],
    kpis: [],
    chartData: [],
  },
  accidentData: {
    tableData: [],
    kpis: [],
    chartData: [],
  },
  workloadData: {
    data: workloadData
  }
};

const loadDatabase = () => {
    try {
        const storedDb = localStorage.getItem(DB_STORAGE_KEY);
        if (storedDb) {
            return JSON.parse(storedDb);
        }
    } catch (error) {
        console.error("Failed to parse database from localStorage, using default.", error);
        localStorage.removeItem(DB_STORAGE_KEY);
    }
    return JSON.parse(JSON.stringify(defaultDatabase));
};

const mockDatabase = loadDatabase();

const persistDatabase = () => {
    try {
        localStorage.setItem(DB_STORAGE_KEY, JSON.stringify(mockDatabase));
    } catch (error) {
        console.error("Failed to save database to localStorage.", error);
    }
};

const mockApi = {
  getData: () => new Promise(resolve => setTimeout(() => resolve(JSON.parse(JSON.stringify(mockDatabase))), 1500)),
  updateKpi: (data) => new Promise(resolve => setTimeout(() => {
    mockDatabase.kpiData = data;
    persistDatabase();
    resolve(JSON.parse(JSON.stringify(mockDatabase.kpiData)));
  }, 500)),
  updateConsumables: (data) => new Promise(resolve => setTimeout(() => {
    mockDatabase.consumablesData = data;
    persistDatabase();
    resolve(JSON.parse(JSON.stringify(mockDatabase.consumablesData)));
  }, 500)),
  updateOt: (data) => new Promise(resolve => setTimeout(() => {
    mockDatabase.otData = data;
    persistDatabase();
    resolve(JSON.parse(JSON.stringify(mockDatabase.otData)));
  }, 500)),
  updateLeave: (data) => new Promise(resolve => setTimeout(() => {
    mockDatabase.leaveData = data;
    persistDatabase();
    resolve(JSON.parse(JSON.stringify(mockDatabase.leaveData)));
  }, 500)),
  updateAccident: (data) => new Promise(resolve => setTimeout(() => {
    mockDatabase.accidentData = data;
    persistDatabase();
    resolve(JSON.parse(JSON.stringify(mockDatabase.accidentData)));
  }, 500)),
  updateWorkload: (data) => new Promise(resolve => setTimeout(() => {
    mockDatabase.workloadData = data;
    persistDatabase();
    resolve(JSON.parse(JSON.stringify(mockDatabase.workloadData)));
  }, 500)),
};
// ===================================================
// END: MOCK BACKEND
// ===================================================

// ===================================================
// START: components/KPICard.tsx
// ===================================================
const IconComponent = ({ name, className }) => {
    switch (name) {
        case 'CurrencyDollarIcon': return <CurrencyDollarIcon className={className} />;
        case 'ShoppingCartIcon': return <ShoppingCartIcon className={className} />;
        case 'UsersIcon': return <UsersIcon className={className} />;
        case 'UserGroupIcon': return <UserGroupIcon className={className} />;
        case 'ChartBarIcon': return <ChartBarIcon className={className} />;
        case 'ArchiveBoxIcon': return <ArchiveBoxIcon className={className} />;
        case 'BuildingOfficeIcon': return <BuildingOfficeIcon className={className} />;
        case 'DocumentTextIcon': return <DocumentTextIcon className={className} />;
        case 'ClockIcon': return <ClockIcon className={className} />;
        case 'ClipboardDocumentCheckIcon': return <ClipboardDocumentCheckIcon className={className} />;
        case 'ExclamationTriangleIcon': return <ExclamationTriangleIcon className={className} />;
        case 'ForkliftIcon': return <ForkliftIcon className={className} />;
        case 'LeafIcon': return <LeafIcon className={className} />;
        case 'MedicalBagIcon': return <MedicalBagIcon className={className} />;
        case 'BookIcon': return <BookIcon className={className} />;
        case 'StairsIcon': return <StairsIcon className={className} />;
        case 'CubeIcon': return <CubeIcon className={className} />;
        case 'SparklesIcon': return <SparklesIcon className={className} />;
        case 'ShieldCheckIcon': return <ShieldCheckIcon className={className} />;
        case 'AcademicCapIcon': return <AcademicCapIcon className={className} />;
        case 'ChartPieIcon': return <ChartPieIcon className={className} />;
        default: return null;
    }
};
const KPICard = ({ title, value, target, trend, trendDirection = 'neutral', icon, color }) => {
  const { t } = useTranslation();
  const TrendIcon = () => {
    switch (trendDirection) {
      case 'up':
        return <ArrowTrendingUpIcon className="h-5 w-5 text-brand-success" />;
      case 'down':
        return <ArrowTrendingDownIcon className="h-5 w-5 text-brand-danger" />;
      default:
        return <MinusIcon className="h-5 w-5 text-light-text-secondary dark:text-dark-text-secondary" />;
    }
  };
  const trendColor = trendDirection === 'up' ? 'text-brand-success' : trendDirection === 'down' ? 'text-brand-danger' : 'text-light-text-secondary dark:text-dark-text-secondary';
  return (
    <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl p-6 flex flex-col gap-4 transform hover:-translate-y-1 transition-transform duration-300 shadow-lg">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-medium text-light-text-secondary dark:text-dark-text-secondary">{title}</h3>
        <div className={color}>
          <IconComponent name={icon} className="h-8 w-8" />
        </div>
      </div>
      <div>
        <p className="text-4xl font-bold text-light-text-primary dark:text-dark-text-primary">{value}</p>
        {target && target !== 'N/A' && (
          <p className="text-sm text-light-text-secondary dark:text-dark-text-secondary mt-1">
            {t('target')}: {target}
          </p>
        )}
      </div>
      {trend && (
        <div className="flex items-center gap-2 text-md">
          <TrendIcon />
          <span className={trendColor}>{trend}</span>
          <span className="text-light-text-secondary dark:text-dark-text-secondary">{t('vsLastMonth')}</span>
        </div>
      )}
    </div>
  );
};
// ===================================================
// END: components/KPICard.tsx
// ===================================================


// ===================================================
// START: components/MainChart.tsx
// ===================================================
const CustomTooltip = ({ active, payload, label }) => {
  if (active && payload && payload.length) {
    return (
      <div className="bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm p-4 border border-light-border dark:border-dark-border rounded-lg shadow-lg">
        <p className="label text-lg font-semibold text-light-text-primary dark:text-dark-text-primary">{`${label}`}</p>
        <p className="intro text-brand-primary">{`Value : ${payload[0].value?.toLocaleString()}`}</p>
      </div>
    );
  }
  return null;
};
const DataLabel = (props) => {
    const { x, y, width, value, theme } = props;
    const textColor = theme === 'dark' ? '#94A3B8' : '#64748B';
    if (value === 0 || !value) {
        return null;
    }
    const formattedValue = value.toLocaleString(undefined, {
      maximumFractionDigits: 2,
    });
    return (
        <text x={x + width / 2} y={y} dy={-6} fill={textColor} fontSize={12} textAnchor="middle">
            {formattedValue}
        </text>
    );
};
const MainChart = ({ data, title, theme }) => {
  const { t } = useTranslation();
  const gridColor = theme === 'dark' ? '#334155' : '#E2E8F0';
  const tickColor = theme === 'dark' ? '#94A3B8' : '#64748B';
  return (
    <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl p-6 h-[480px] shadow-lg">
      <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary mb-6">{title || t('kpiProgressOverview')}</h3>
      <ResponsiveContainer width="100%" height="90%">
        <BarChart
          data={data}
          margin={{
            top: 20,
            right: 20,
            left: 10,
            bottom: 5,
          }}
        >
          <CartesianGrid strokeDasharray="3 3" stroke={gridColor} />
          <XAxis dataKey="name" stroke={tickColor} tick={{ fill: tickColor }} />
          <YAxis stroke={tickColor} tick={{ fill: tickColor }} />
          <Tooltip content={<CustomTooltip />} />
          <Bar dataKey="value" fill="#6366F1">
            <LabelList dataKey="value" content={<DataLabel theme={theme} />} />
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </div>
  );
};
// ===================================================
// END: components/MainChart.tsx
// ===================================================


// ===================================================
// START: components/DataTable.tsx
// ===================================================
const DataTable = ({ data }) => {
  const { t } = useTranslation();
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedKpi, setSelectedKpi] = useState(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [isEditMode, setIsEditMode] = useState(false);
  const [editedKpi, setEditedKpi] = useState(null);
  
  const filteredData = data.filter(row => {
    const lowerCaseSearchTerm = searchTerm.toLowerCase();
    return (
      row.kpi.title.toLowerCase().includes(lowerCaseSearchTerm) ||
      row.kpi.measurement.toLowerCase().includes(lowerCaseSearchTerm) ||
      row.target.toLowerCase().includes(lowerCaseSearchTerm) ||
      row.score.toLowerCase().includes(lowerCaseSearchTerm) ||
      row.result.toLowerCase().includes(lowerCaseSearchTerm)
    );
  });

  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ KPI
  const getKpiDetails = (kpiTitle) => {
    const titleLower = String(kpiTitle).toLowerCase();
    
    if (titleLower.includes('availability') && titleLower.includes('forklift') || 
        titleLower.includes('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡∏¢‡∏Å') || 
        titleLower.includes('avaliability')) {
      return {
        description: '‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡∏¢‡∏Å‡πÇ‡∏ü‡∏•‡πå‡∏Ñ‡∏•‡∏¥‡∏ü‡∏ó‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô',
        objective: '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÇ‡∏ü‡∏•‡πå‡∏Ñ‡∏•‡∏¥‡∏ü‡∏ó‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û',
        methodology: '‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏ñ‡∏¢‡∏Å‡πÇ‡∏ü‡∏•‡πå‡∏Ñ‡∏•‡∏¥‡∏ü‡∏ó‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
        frequency: '‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô',
        responsible: '‡∏ù‡πà‡∏≤‡∏¢‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡πÅ‡∏•‡∏∞ ‡∏ù‡πà‡∏≤‡∏¢‡πÇ‡∏•‡∏à‡∏¥‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡πå',
        improvementActions: [
          '‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô',
          '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏†‡∏≤‡∏û‡∏£‡∏ñ‡∏¢‡∏Å‡πÇ‡∏ü‡∏•‡πå‡∏Ñ‡∏•‡∏¥‡∏ü‡∏ó‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥',
          '‡∏à‡∏±‡∏î‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô',
          '‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'
        ]
      };
    }
    
    if (titleLower.includes('initiative') && titleLower.includes('carbon') || 
        titleLower.includes('‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏Å‡πä‡∏≤‡∏ã‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô') ||
        titleLower.includes('carbon') && titleLower.includes('emission')) {
      return {
        description: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ó‡∏µ‡πà‡∏°‡∏∏‡πà‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏Å‡πä‡∏≤‡∏ã‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô‡πÑ‡∏î‡∏≠‡∏≠‡∏Å‡πÑ‡∏ã‡∏î‡πå',
        objective: '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô',
        methodology: '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
        frequency: '‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
        responsible: '‡∏ù‡πà‡∏≤‡∏¢‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° ‡πÅ‡∏•‡∏∞ ‡∏ù‡πà‡∏≤‡∏¢‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£',
        improvementActions: [
          '‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô',
          '‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï',
          '‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô',
          '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'
        ]
      };
    }
    
    if (titleLower.includes('‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏') && titleLower.includes('ifr') || 
        titleLower.includes('ifr') && titleLower.includes('2024') ||
        titleLower.includes('accident') && titleLower.includes('ifr')) {
      return {
        description: '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô 1 ‡∏•‡πâ‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á',
        objective: '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
        methodology: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö √ó 1,000,000 √∑ ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
        frequency: '‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
        responsible: '‡∏ù‡πà‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏•‡∏∞ ‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•',
        improvementActions: [
          '‡∏à‡∏±‡∏î‡∏≠‡∏ö‡∏£‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥',
          '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
          '‡πÉ‡∏ä‡πâ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°',
          '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£'
        ]
      };
    }
    
    if (titleLower.includes('lean') && titleLower.includes('management') || 
        titleLower.includes('‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤') ||
        titleLower.includes('lean mamagement system')) {
      return {
        description: '‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏•‡∏µ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢',
        objective: '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô',
        methodology: '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Lean Management ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á',
        frequency: '‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™',
        responsible: '‡∏ù‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞ ‡∏ù‡πà‡∏≤‡∏¢‡∏ú‡∏•‡∏¥‡∏ï',
        improvementActions: [
          '‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£',
          '‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Lean Thinking',
          '‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ Lean Tools ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå',
          '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡∏°‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å'
        ]
      };
    }
    
    if (titleLower.includes('idp') && titleLower.includes('implementation') || 
        titleLower.includes('idp implementation succeed g4-g7') ||
        titleLower.includes('‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å')) {
      return {
        description: '‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Individual Development Plan) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö G4-G7',
        objective: '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
        methodology: '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏° IDP ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•',
        frequency: '‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™',
        responsible: '‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• ‡πÅ‡∏•‡∏∞ ‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏≤‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á',
        improvementActions: [
          '‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô IDP ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á',
          '‡∏à‡∏±‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°',
          '‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤',
          '‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏ú‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á'
        ]
      };
    }
    
    // Default details for unknown KPIs
    return {
      description: '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á KPI ‡∏ô‡∏µ‡πâ',
      objective: '‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î KPI ‡∏ô‡∏µ‡πâ',
      methodology: '‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì',
      frequency: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î',
      responsible: '‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö',
      improvementActions: ['‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á 1', '‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á 2']
    };
  };

  const handleRowClick = (row) => {
    setSelectedKpi({
      ...row,
      // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏≤‡∏Å‡∏°‡∏µ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      description: row.description || getKpiDetails(row.kpi.title).description,
      objective: row.objective || getKpiDetails(row.kpi.title).objective,
      measurementMethod: row.measurementMethod || getKpiDetails(row.kpi.title).methodology,
      responsible: row.responsible || getKpiDetails(row.kpi.title).responsible,
      improvementPlan: row.improvementPlan || getKpiDetails(row.kpi.title).improvementActions.join('\n')
    });
    setIsModalOpen(true);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    setSelectedKpi(null);
    setIsEditMode(false);
    setEditedKpi(null);
  };

  const startEdit = () => {
    setIsEditMode(true);
    setEditedKpi({ ...selectedKpi });
  };

  const cancelEdit = () => {
    setIsEditMode(false);
    setEditedKpi(null);
  };

  const saveEdit = () => {
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    const updatedData = data.map(row => 
      row.kpi.title === selectedKpi.kpi.title ? editedKpi : row
    );
    // ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend ‡∏´‡∏£‡∏∑‡∏≠ localStorage
    setSelectedKpi(editedKpi);
    setIsEditMode(false);
    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
  };

  const handleMonthlyDataChange = (month, value) => {
    setEditedKpi(prev => ({
      ...prev,
      monthlyData: {
        ...prev.monthlyData,
        [month]: value
      }
    }));
  };
  return (
    <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
      <div className="p-6 border-b border-light-border dark:border-dark-border flex justify-between items-center flex-wrap gap-4">
        <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('kpiDetails')}</h3>
        <div className="relative">
          <MagnifyingGlassIcon className="h-5 w-5 absolute top-1/2 left-3 -translate-y-1/2 text-light-text-secondary dark:text-dark-text-secondary" />
          <input
            type="text"
            placeholder={t('searchDetails')}
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg pl-10 pr-4 py-2 text-light-text-primary dark:text-dark-text-primary focus:outline-none focus:ring-2 focus:ring-brand-primary w-full sm:w-64"
          />
        </div>
      </div>
      <div className="overflow-auto max-h-[600px]">
        <table className="w-full text-left">
          <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
            <tr className="border-b border-light-border dark:border-dark-border">
              <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">KPI NO.</th>
              <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">KPI Title</th>
              <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">Target</th>
              <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">Score</th>
              <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">Result</th>
            </tr>
          </thead>
          <tbody className='divide-y divide-light-border dark:divide-dark-border'>
            {filteredData.length > 0 ? (
              filteredData.map((row, index) => (
              <tr 
                key={index} 
                className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors cursor-pointer"
                onClick={() => handleRowClick(row)}
                title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"
              >
                <td className="p-4">
                  <div className="font-medium text-light-text-primary dark:text-dark-text-primary">{row.kpiNo || 'N/A'}</div>
                </td>
                <td className="p-4 max-w-xs">
                  <div className="font-medium text-light-text-primary dark:text-dark-text-primary whitespace-normal break-words" title={row.kpi.title}>{row.kpi.title}</div>
                </td>
                <td className="p-4">
                    <div className="font-medium text-light-text-primary dark:text-dark-text-primary">{row.target}</div>
                </td>
                <td className="p-4 font-medium text-light-text-primary dark:text-dark-text-primary text-right">{formatScoreForKpiDetails(row.score, row.kpi.title)}</td>
                <td className="p-4 text-right">
                    <span className={`px-2 py-1 text-xs font-semibold rounded-full ${
                        row.result.toUpperCase() === 'PASS' 
                        ? 'bg-green-500/20 text-green-400' 
                        : 'bg-amber-500/20 text-amber-400'
                    }`}>
                        {row.result.toUpperCase() === 'PASS' ? t('pass') : t('inProgress')}
                    </span>
                </td>
              </tr>
              ))
            ) : (
              <tr>
                <td colSpan={5} className="text-center p-8 text-light-text-secondary dark:text-dark-text-secondary">
                  {t('noResultsFound')}
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
      
      {/* Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î KPI */}
      {isModalOpen && selectedKpi && (
        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onClick={closeModal}>
          <div 
            className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto"
            onClick={(e) => e.stopPropagation()}
          >
            {/* Header */}
            <div className="p-6 border-b border-light-border dark:border-dark-border flex justify-between items-start">
              <div className="flex-1">
                <h2 className="text-2xl font-bold text-light-text-primary dark:text-dark-text-primary mb-2">
                  {isEditMode ? (
                    <input
                      type="text"
                      value={editedKpi?.kpi?.title || ''}
                      onChange={(e) => setEditedKpi(prev => ({
                        ...prev,
                        kpi: { ...prev.kpi, title: e.target.value }
                      }))}
                      className="w-full p-2 border border-light-border dark:border-dark-border rounded-lg bg-light-bg dark:bg-dark-bg text-light-text-primary dark:text-dark-text-primary"
                    />
                  ) : (
                    selectedKpi.kpi.title
                  )}
                </h2>
                <p className="text-light-text-secondary dark:text-dark-text-secondary">
                  {isEditMode ? (
                    <input
                      type="text"
                      value={editedKpi?.kpi?.measurement || ''}
                      onChange={(e) => setEditedKpi(prev => ({
                        ...prev,
                        kpi: { ...prev.kpi, measurement: e.target.value }
                      }))}
                      className="w-full p-2 border border-light-border dark:border-dark-border rounded-lg bg-light-bg dark:bg-dark-bg text-light-text-secondary dark:text-dark-text-secondary"
                    />
                  ) : (
                    selectedKpi.kpi.measurement
                  )}
                </p>
              </div>
              <div className="flex gap-2 ml-4">
                {!isEditMode ? (
                  <button
                    onClick={startEdit}
                    className="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg transition-colors"
                  >
                    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                  </button>
                ) : (
                  <>
                    <button
                      onClick={saveEdit}
                      className="px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg transition-colors"
                    >
                      ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button
                      onClick={cancelEdit}
                      className="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg transition-colors"
                    >
                      ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                  </>
                )}
                <button
                  onClick={closeModal}
                  className="p-2 hover:bg-light-bg dark:hover:bg-dark-bg rounded-lg transition-colors"
                  aria-label="‡∏õ‡∏¥‡∏î"
                >
                  <XMarkIcon className="h-6 w-6 text-light-text-secondary dark:text-dark-text-secondary" />
                </button>
              </div>
            </div>
            
            {/* Content */}
            <div className="p-6">
              {/* KPI Summary */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div className="bg-light-bg dark:bg-dark-bg rounded-lg p-4">
                  <h3 className="text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase mb-2">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h3>
                  {isEditMode ? (
                    <input
                      type="text"
                      value={editedKpi?.target || ''}
                      onChange={(e) => setEditedKpi(prev => ({ ...prev, target: e.target.value }))}
                      className="w-full p-2 text-xl font-bold border border-light-border dark:border-dark-border rounded-lg bg-white dark:bg-gray-700 text-light-text-primary dark:text-dark-text-primary"
                    />
                  ) : (
                    <p className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{selectedKpi.target}</p>
                  )}
                </div>
                <div className="bg-light-bg dark:bg-dark-bg rounded-lg p-4">
                  <h3 className="text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase mb-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
                  {isEditMode ? (
                    <input
                      type="text"
                      value={editedKpi?.score || ''}
                      onChange={(e) => setEditedKpi(prev => ({ ...prev, score: e.target.value }))}
                      className="w-full p-2 text-xl font-bold border border-light-border dark:border-dark-border rounded-lg bg-white dark:bg-gray-700 text-light-text-primary dark:text-dark-text-primary"
                    />
                  ) : (
                    <p className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">
                      {formatScoreForKpiDetails(selectedKpi.score, selectedKpi.kpi.title)}
                    </p>
                  )}
                </div>
                <div className="bg-light-bg dark:bg-dark-bg rounded-lg p-4">
                  <h3 className="text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase mb-2">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h3>
                  {isEditMode ? (
                    <select
                      value={editedKpi?.result || ''}
                      onChange={(e) => setEditedKpi(prev => ({ ...prev, result: e.target.value }))}
                      className="w-full p-2 border border-light-border dark:border-dark-border rounded-lg bg-white dark:bg-gray-700 text-light-text-primary dark:text-dark-text-primary"
                    >
                      <option value="PASS">PASS</option>
                      <option value="IN PROGRESS">IN PROGRESS</option>
                    </select>
                  ) : (
                    <span className={`inline-block px-3 py-1 text-sm font-semibold rounded-full ${
                      selectedKpi.result.toUpperCase() === 'PASS' 
                      ? 'bg-green-500/20 text-green-400' 
                      : 'bg-amber-500/20 text-amber-400'
                    }`}>
                      {selectedKpi.result.toUpperCase() === 'PASS' ? t('pass') : t('inProgress')}
                    </span>
                  )}
                </div>
              </div>
              
              {/* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô */}
              <div className="mb-8">
                <h3 className="text-lg font-semibold text-light-text-primary dark:text-dark-text-primary mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                <div className="grid grid-cols-6 gap-3">
                  {['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'].map((month) => (
                    <div key={month} className="text-center">
                      <label className="block text-xs font-medium text-light-text-secondary dark:text-dark-text-secondary mb-2">{month}</label>
                      {isEditMode ? (
                        <input
                          type="text"
                          value={editedKpi?.monthlyData?.[month] || ''}
                          onChange={(e) => handleMonthlyDataChange(month, e.target.value)}
                          className="w-full p-2 text-sm border border-light-border dark:border-dark-border rounded bg-white dark:bg-gray-700 text-light-text-primary dark:text-dark-text-primary text-center"
                        />
                      ) : (
                        <div className="p-2 text-sm bg-light-bg dark:bg-dark-bg rounded text-light-text-primary dark:text-dark-text-primary text-center border border-light-border dark:border-dark-border">
                          {selectedKpi.monthlyData?.[month] || '-'}
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </div>
              
              {/* Detailed Information */}
              <div className="space-y-6">
                <div>
                  <h3 className="text-lg font-semibold text-light-text-primary dark:text-dark-text-primary mb-3">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</h3>
                  {isEditMode ? (
                    <textarea
                      value={editedKpi?.description || ''}
                      onChange={(e) => setEditedKpi(prev => ({
                        ...prev,
                        description: e.target.value
                      }))}
                      rows="3"
                      className="w-full p-3 border border-light-border dark:border-dark-border rounded-lg bg-white dark:bg-gray-700 text-light-text-primary dark:text-dark-text-primary"
                    />
                  ) : (
                    <p className="text-light-text-secondary dark:text-dark-text-secondary leading-relaxed">
                      {selectedKpi.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
                    </p>
                  )}
                </div>
                
                <div>
                  <h3 className="text-lg font-semibold text-light-text-primary dark:text-dark-text-primary mb-3">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</h3>
                  {isEditMode ? (
                    <textarea
                      value={editedKpi?.objective || ''}
                      onChange={(e) => setEditedKpi(prev => ({
                        ...prev,
                        objective: e.target.value
                      }))}
                      rows="3"
                      className="w-full p-3 border border-light-border dark:border-dark-border rounded-lg bg-white dark:bg-gray-700 text-light-text-primary dark:text-dark-text-primary"
                    />
                  ) : (
                    <p className="text-light-text-secondary dark:text-dark-text-secondary leading-relaxed">
                      {selectedKpi.objective || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
                    </p>
                  )}
                </div>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <h3 className="text-lg font-semibold text-light-text-primary dark:text-dark-text-primary mb-3">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î</h3>
                    {isEditMode ? (
                      <textarea
                        value={editedKpi?.measurementMethod || ''}
                        onChange={(e) => setEditedKpi(prev => ({
                          ...prev,
                          measurementMethod: e.target.value
                        }))}
                        rows="3"
                        className="w-full p-3 border border-light-border dark:border-dark-border rounded-lg bg-white dark:bg-gray-700 text-light-text-primary dark:text-dark-text-primary"
                      />
                    ) : (
                      <p className="text-light-text-secondary dark:text-dark-text-secondary leading-relaxed">
                        {selectedKpi.measurementMethod || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
                      </p>
                    )}
                  </div>
                  
                  <div>
                    <h3 className="text-lg font-semibold text-light-text-primary dark:text-dark-text-primary mb-3">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</h3>
                    {isEditMode ? (
                      <input
                        type="text"
                        value={editedKpi?.responsible || ''}
                        onChange={(e) => setEditedKpi(prev => ({
                          ...prev,
                          responsible: e.target.value
                        }))}
                        className="w-full p-3 border border-light-border dark:border-dark-border rounded-lg bg-white dark:bg-gray-700 text-light-text-primary dark:text-dark-text-primary"
                      />
                    ) : (
                      <p className="text-light-text-secondary dark:text-dark-text-secondary leading-relaxed">
                        {selectedKpi.responsible || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
                      </p>
                    )}
                  </div>
                </div>
                
                <div>
                  <h3 className="text-lg font-semibold text-light-text-primary dark:text-dark-text-primary mb-3">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</h3>
                  {isEditMode ? (
                    <textarea
                      value={editedKpi?.improvementPlan || ''}
                      onChange={(e) => setEditedKpi(prev => ({
                        ...prev,
                        improvementPlan: e.target.value
                      }))}
                      rows="4"
                      className="w-full p-3 border border-light-border dark:border-dark-border rounded-lg bg-white dark:bg-gray-700 text-light-text-primary dark:text-dark-text-primary"
                    />
                  ) : (
                    <p className="text-light-text-secondary dark:text-dark-text-secondary leading-relaxed">
                      {selectedKpi.improvementPlan || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
                    </p>
                  )}
                </div>
              </div>
            </div>
            
            {/* Footer */}
            <div className="p-6 border-t border-light-border dark:border-dark-border flex justify-end">
              <button
                onClick={closeModal}
                className="px-6 py-2 bg-brand-primary text-white font-semibold rounded-lg hover:bg-indigo-500 transition-colors duration-300"
              >
                ‡∏õ‡∏¥‡∏î
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};
// ===================================================
// END: components/DataTable.tsx
// ===================================================


// ===================================================
// START: components/ConsumablesReport.tsx
// ===================================================
const ConsumablesReport = ({ tableData, kpis, chartData, onFileUpload, theme }) => {
    const { t } = useTranslation();
    const fileInputRef = useRef(null);
    const [searchTerm, setSearchTerm] = useState('');
    const handleUploadClick = () => {
        fileInputRef.current?.click();
    };
    const handleFileChange = (event) => {
        const file = event.target.files?.[0];
        if (file) {
            onFileUpload(file);
        }
    };
    const headers = ['Date', 'Material', 'Description', 'Qty', 'Unit', 'Price', 'Total', 'CostCtr', 'Dept'];
    const filteredData = tableData.filter(row =>
        Object.values(row).some(value =>
            String(value).toLowerCase().includes(searchTerm.toLowerCase())
        )
    );
    const groupedByMaterial = useMemo(() => {
        const groups = {};
        filteredData.forEach(row => {
            const key = row.material && String(row.material).trim() !== '' ? row.material : '‡∏≠‡∏∑‡πà‡∏ô‡πÜ';
            if (!groups[key]) {
                groups[key] = { rows: [], subtotal: 0 };
            }
            groups[key].rows.push(row);
            const price = parseFloat(String(row.totalPrice).replace(/[^0-9.-]+/g, "")) || 0;
            groups[key].subtotal += price;
        });
        return Object.entries(groups).sort((a, b) => String(a[0]).localeCompare(String(b[0])));
    }, [filteredData]);
    const topItems = useMemo(() => {
        if (!tableData || tableData.length === 0) {
            return [];
        }
        const itemStats = {};
        tableData.forEach(row => {
            const materialKey = row.material;
            if (!materialKey) return; 
            const price = parseFloat(String(row.totalPrice).replace(/[^0-9.-]+/g, "")) || 0;
            if (!itemStats[materialKey]) {
                itemStats[materialKey] = {
                    description: row.description,
                    count: 0,
                    total: 0
                };
            }
            itemStats[materialKey].count += 1;
            itemStats[materialKey].total += price;
        });
        return Object.entries(itemStats)
            .map(([material, stats]) => ({
                material,
                description: stats.description,
                count: stats.count,
                total: stats.total,
            }))
            .sort((a, b) => b.count - a.count)
            .slice(0, 5);
    }, [tableData]);
    const departmentCosts = useMemo(() => {
        if (!tableData || tableData.length === 0) {
            return [];
        }
        const costsByDept = {};
        tableData.forEach(row => {
            const price = parseFloat(String(row.totalPrice).replace(/[^0-9.-]+/g, "")) || 0;
            const dept = row.department.trim().toUpperCase();
            if (dept) {
                costsByDept[dept] = (costsByDept[dept] || 0) + price;
            }
        });
        const resultData = [
            { name: 'FILM', total: costsByDept['FILM'] || 0 },
            { name: 'SSRM', total: costsByDept['SSRM'] || 0 },
            { name: 'MH', total: costsByDept['MH'] || 0 },
            { name: 'COIL', total: costsByDept['COIL'] || 0 },
            { name: 'Admin & Incoming', total: (costsByDept['ADMIN'] || 0) + (costsByDept['INCOMING'] || 0) + (costsByDept['ADMIN&INCOMING'] || 0) }
        ].filter(d => d.total > 0);
        return resultData.sort((a, b) => b.total - a.total);
    }, [tableData]);
    return (
        <div className="container mx-auto">
             <div className="flex justify-end items-center mb-6">
                <input
                    type="file"
                    ref={fileInputRef}
                    onChange={handleFileChange}
                    className="hidden"
                    accept=".xlsx, .xls"
                />
                <button
                    onClick={handleUploadClick}
                    className="flex items-center gap-2 bg-brand-primary text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-500 transition-colors duration-300"
                    aria-label="Upload Consumables Excel file"
                >
                    <ArrowUpTrayIcon className="h-5 w-5" />
                    <span>{t('uploadExcel')}</span>
                </button>
            </div>
            {tableData.length > 0 ? (
                <div className="flex flex-col gap-8">
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        {kpis.map((kpi, index) => (
                            <KPICard
                                key={index}
                                title={kpi.title}
                                value={kpi.value}
                                icon={kpi.icon}
                                color={kpi.color}
                            />
                        ))}
                    </div>
                    <MainChart data={chartData} title={t('monthlyConsumablesCost')} theme={theme} />
                    <div className="grid grid-cols-1 xl:grid-cols-2 gap-8">
                        <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                            <div className="p-6 border-b border-light-border dark:border-dark-border">
                                <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('top5FrequentItems')}</h3>
                            </div>
                            <div className="overflow-auto">
                                <table className="w-full text-left">
                                    <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                                        <tr className="border-b border-light-border dark:border-dark-border">
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">#</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">Description</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-center">{t('frequency')}</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">{t('totalCost')}</th>
                                        </tr>
                                    </thead>
                                    <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                                        {topItems.length > 0 ? topItems.map((item, index) => (
                                            <tr key={item.material} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary font-medium">{index + 1}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary max-w-sm truncate" title={item.description}>{item.description}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-center">{item.count}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-right font-semibold">
                                                    {item.total.toLocaleString('th-TH', { style: 'currency', currency: 'THB' })}
                                                </td>
                                            </tr>
                                        )) : (
                                            <tr>
                                                <td colSpan={4} className="text-center p-8 text-light-text-secondary dark:text-dark-text-secondary">
                                                    {t('noDataLoaded')}
                                                </td>
                                            </tr>
                                        )}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                            <div className="p-6 border-b border-light-border dark:border-dark-border">
                                <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('costByDepartment')}</h3>
                            </div>
                            <div className="overflow-auto">
                                <table className="w-full text-left">
                                    <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                                        <tr className="border-b border-light-border dark:border-dark-border">
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">{t('department')}</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">{t('totalCost')}</th>
                                        </tr>
                                    </thead>
                                    <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                                        {departmentCosts.length > 0 ? departmentCosts.map((item) => (
                                            <tr key={item.name} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary font-medium">{item.name}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-right font-semibold">
                                                    {item.total.toLocaleString('th-TH', { style: 'currency', currency: 'THB' })}
                                                </td>
                                            </tr>
                                        )) : (
                                            <tr>
                                                <td colSpan={2} className="text-center p-8 text-light-text-secondary dark:text-dark-text-secondary">
                                                    {t('noDataLoaded')}
                                                </td>
                                            </tr>
                                        )}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                        <div className="p-6 border-b border-light-border dark:border-dark-border flex justify-between items-center flex-wrap gap-4">
                            <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('recentTransactions')}</h3>
                             <div className="relative">
                                <MagnifyingGlassIcon className="h-5 w-5 absolute top-1/2 left-3 -translate-y-1/2 text-light-text-secondary dark:text-dark-text-secondary" />
                                <input
                                    type="text"
                                    placeholder={t('searchTransactions')}
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg pl-10 pr-4 py-2 text-light-text-primary dark:text-dark-text-primary focus:outline-none focus:ring-2 focus:ring-brand-primary w-full sm:w-64"
                                />
                            </div>
                        </div>
                        <div className="overflow-auto max-h-[600px]">
                            <table className="w-full text-left">
                                <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                                    <tr className="border-b border-light-border dark:border-dark-border">
                                        {headers.map(header => (
                                            <th key={header} className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase whitespace-nowrap">{header}</th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                                    {filteredData.length > 0 ? (
                                        groupedByMaterial.map(([material, group]) => (
                                            <React.Fragment key={material}>
                                                <tr className="bg-slate-50/60 dark:bg-dark-bg/50">
                                                    <td colSpan={headers.length} className="p-4">
                                                        <div className="flex items-center justify-between">
                                                            <span className="text-sm font-semibold text-light-text-primary dark:text-dark-text-primary">Material: {material}</span>
                                                            <span className="text-sm font-semibold text-brand-primary">{group.subtotal.toLocaleString('th-TH', { style: 'currency', currency: 'THB' })}</span>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {group.rows.map((row, index) => (
                                                    <tr key={`${material}-${index}`} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.date}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.material}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary max-w-xs truncate" title={row.description}>{row.description}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.quantity}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.unit}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.price}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.totalPrice}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.costCenter}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.department}</td>
                                                    </tr>
                                                ))}
                                            </React.Fragment>
                                        ))
                                    ) : (
                                        <tr>
                                            <td colSpan={headers.length} className="text-center p-8 text-light-text-secondary dark:text-dark-text-secondary">
                                            {t('noResultsFound')}
                                            </td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            ) : (
                <div className="mt-8 flex items-center justify-center bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg p-16">
                    <div className="text-center">
                        <DocumentTextIcon className="mx-auto h-12 w-12 text-light-text-secondary dark:text-dark-text-secondary" />
                        <h3 className="mt-4 text-lg font-medium text-light-text-primary dark:text-dark-text-primary">{t('noDataLoaded')}</h3>
                        <p className="mt-1 text-sm text-light-text-secondary dark:text-dark-text-secondary">
                            {t('noDataLoadedMessageConsumables')}
                        </p>
                    </div>
                </div>
            )}
        </div>
    );
};
// ===================================================
// END: components/ConsumablesReport.tsx
// ===================================================


// ===================================================
// START: components/OTReport.tsx
// ===================================================
const OTReport = ({ tableData, kpis, chartData, onFileUpload, theme }) => {
    const { t } = useTranslation();
    const fileInputRef = useRef(null);
    const [searchTerm, setSearchTerm] = useState('');
    const handleUploadClick = () => {
        fileInputRef.current?.click();
    };
    const handleFileChange = (event) => {
        const file = event.target.files?.[0];
        if (file) {
            onFileUpload(file);
        }
    };
    const headers = ['ID', 'Employee ID', 'Name', 'Position', 'Department', 'Grade', 'Status', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Total'];
    const filteredData = tableData.filter(row => {
        const searchString = searchTerm.toLowerCase();
        return (
            row.id.toLowerCase().includes(searchString) ||
            row.employeeId.toLowerCase().includes(searchString) ||
            row.name.toLowerCase().includes(searchString) ||
            row.position.toLowerCase().includes(searchString) ||
            row.department.toLowerCase().includes(searchString) ||
            row.grade.toLowerCase().includes(searchString) ||
            row.status.toLowerCase().includes(searchString) ||
            String(row.totalOT).toLowerCase().includes(searchString)
        );
    });
    const groupedByDepartment = useMemo(() => {
        const groups = {};
        filteredData.forEach(row => {
            const key = row.department && row.department.trim() !== '' ? row.department : 'OTHER';
            if (!groups[key]) {
                groups[key] = { rows: [], subtotal: 0 };
            }
            groups[key].rows.push(row);
            const value = typeof row.totalOT === 'number' ? row.totalOT : parseFloat(String(row.totalOT));
            groups[key].subtotal += (isNaN(value) ? 0 : value);
        });
        return Object.entries(groups).sort((a, b) => String(a[0]).localeCompare(String(b[0])));
    }, [filteredData]);
    const topEmployees = useMemo(() => {
        if (!tableData) return [];
        return [...tableData]
            .sort((a, b) => b.totalOT - a.totalOT)
            .slice(0, 10);
    }, [tableData]);
    const topDepartments = useMemo(() => {
        if (!tableData) return [];
        const departmentTotals = {};
        tableData.forEach(row => {
            if (row.department) {
                departmentTotals[row.department] = (departmentTotals[row.department] || 0) + row.totalOT;
            }
        });
        return Object.entries(departmentTotals)
            .map(([name, total]) => ({ name, total }))
            .sort((a, b) => b.total - a.total)
            .slice(0, 10);
    }, [tableData]);
    return (
        <div className="container mx-auto">
             <div className="flex justify-end items-center mb-6">
                <input
                    type="file"
                    ref={fileInputRef}
                    onChange={handleFileChange}
                    className="hidden"
                    accept=".xlsx, .xls"
                />
                <button
                    onClick={handleUploadClick}
                    className="flex items-center gap-2 bg-brand-primary text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-500 transition-colors duration-300"
                    aria-label="Upload OT Excel file"
                >
                    <ArrowUpTrayIcon className="h-5 w-5" />
                    <span>{t('uploadExcel')}</span>
                </button>
            </div>
            {tableData.length > 0 ? (
                <div className="flex flex-col gap-8">
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        {kpis.map((kpi, index) => (
                            <KPICard
                                key={index}
                                title={kpi.title}
                                value={kpi.value}
                                icon={kpi.icon}
                                color={kpi.color}
                            />
                        ))}
                    </div>
                    <MainChart data={chartData} title={t('monthlyOvertimeHours')} theme={theme} />
                    <div className="grid grid-cols-1 xl:grid-cols-2 gap-8">
                        <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                            <div className="p-6 border-b border-light-border dark:border-dark-border">
                                <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('top10EmployeesByOT')}</h3>
                            </div>
                            <div className="overflow-auto">
                                <table className="w-full text-left">
                                    <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                                        <tr className="border-b border-light-border dark:border-dark-border">
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">#</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">{t('name')}</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">{t('department')}</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">{t('totalHours')}</th>
                                        </tr>
                                    </thead>
                                    <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                                        {topEmployees.map((employee, index) => (
                                            <tr key={employee.employeeId} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary font-medium">{index + 1}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary max-w-xs truncate" title={employee.name}>{employee.name}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary">{employee.department}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-right font-semibold">{employee.totalOT.toFixed(2)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                            <div className="p-6 border-b border-light-border dark:border-dark-border">
                                <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('top10DepartmentsByOT')}</h3>
                            </div>
                            <div className="overflow-auto">
                                <table className="w-full text-left">
                                    <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                                        <tr className="border-b border-light-border dark:border-dark-border">
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">#</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">{t('department')}</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">{t('totalHours')}</th>
                                        </tr>
                                    </thead>
                                    <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                                        {topDepartments.map((dept, index) => (
                                            <tr key={dept.name} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary font-medium">{index + 1}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary">{dept.name}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-right font-semibold">{dept.total.toFixed(2)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                        <div className="p-6 border-b border-light-border dark:border-dark-border flex justify-between items-center flex-wrap gap-4">
                            <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('employeeOTDetails')}</h3>
                            <div className="relative">
                                <MagnifyingGlassIcon className="h-5 w-5 absolute top-1/2 left-3 -translate-y-1/2 text-light-text-secondary dark:text-dark-text-secondary" />
                                <input
                                    type="text"
                                    placeholder={t('searchEmployees')}
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg pl-10 pr-4 py-2 text-light-text-primary dark:text-dark-text-primary focus:outline-none focus:ring-2 focus:ring-brand-primary w-full sm:w-64"
                                />
                            </div>
                        </div>
                        <div className="overflow-auto max-h-[600px]">
                            <table className="w-full text-left min-w-[1200px]">
                                <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                                    <tr className="border-b border-light-border dark:border-dark-border">
                                        {headers.map(header => (
                                            <th key={header} className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase whitespace-nowrap">{header}</th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                                    {filteredData.length > 0 ? (
                                        groupedByDepartment.map(([dept, group]) => (
                                            <React.Fragment key={dept}>
                                                <tr className="bg-slate-50/60 dark:bg-dark-bg/50">
                                                    <td colSpan={headers.length} className="p-4">
                                                        <div className="flex items-center justify-between">
                                                            <span className="text-sm font-semibold text-light-text-primary dark:text-dark-text-primary">Department: {dept}</span>
                                                            <span className="text-sm font-semibold text-brand-primary">{group.subtotal.toFixed(2)}</span>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {group.rows.map((row, idx) => (
                                                    <tr key={`${dept}-${row.employeeId}-${idx}`} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.id}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.employeeId}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap max-w-xs truncate" title={row.name}>{row.name}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.position}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.department}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-center">{row.grade}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-center">{row.status}</td>
                                                        {row.monthlyOT.map((ot, i) => (
                                                            <td key={i} className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{ot.toFixed(2)}</td>
                                                        ))}
                                                        <td className="p-4 text-sm font-bold text-brand-primary whitespace-nowrap text-right">{row.totalOT.toFixed(2)}</td>
                                                    </tr>
                                                ))}
                                            </React.Fragment>
                                        ))
                                    ) : (
                                        <tr>
                                            <td colSpan={headers.length} className="text-center p-8 text-light-text-secondary dark:text-dark-text-secondary">
                                                {t('noResultsFound')}
                                            </td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            ) : (
                <div className="mt-8 flex items-center justify-center bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg p-16">
                    <div className="text-center">
                        <DocumentTextIcon className="mx-auto h-12 w-12 text-light-text-secondary dark:text-dark-text-secondary" />
                        <h3 className="mt-4 text-lg font-medium text-light-text-primary dark:text-dark-text-primary">{t('noDataLoaded')}</h3>
                        <p className="mt-1 text-sm text-light-text-secondary dark:text-dark-text-secondary">
                            {t('noDataLoadedMessageOT')}
                        </p>
                    </div>
                </div>
            )}
        </div>
    );
};
// ===================================================
// END: components/OTReport.tsx
// ===================================================


// ===================================================
// START: components/LeaveReport.tsx
// ===================================================
const LeaveReport = ({ tableData, kpis, chartData, onFileUpload, theme }) => {
    const { t } = useTranslation();
    const fileInputRef = useRef(null);
    const [searchTerm, setSearchTerm] = useState('');
    const handleUploadClick = () => {
        fileInputRef.current?.click();
    };
    const handleFileChange = (event) => {
        const file = event.target.files?.[0];
        if (file) {
            onFileUpload(file);
        }
    };
    const headers = ['NO.', 'EMP.', 'NAME-SURENAME', 'POSITION', 'DEPT.', 'Grade', 'STATUS', 'JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC', 'Leave (No Vac)', 'Leave (w/ Vac)', 'Vac Carried', 'Vac Entitled', 'Total Vac', 'Vac Used', 'Vac Accrued', 'Sick', 'Personal', 'Birthday', 'Other', 'Total'];
    const filteredData = tableData.filter(row => {
        const searchString = searchTerm.toLowerCase();
        return (
            row.id.toLowerCase().includes(searchString) ||
            row.employeeId.toLowerCase().includes(searchString) ||
            row.name.toLowerCase().includes(searchString) ||
            row.position.toLowerCase().includes(searchString) ||
            row.department.toLowerCase().includes(searchString) ||
            row.grade.toLowerCase().includes(searchString) ||
            row.status.toLowerCase().includes(searchString) ||
            String(row.totalLeave).toLowerCase().includes(searchString)
        );
    });
    const groupedByDepartment = useMemo(() => {
        const groups = {};
        filteredData.forEach(row => {
            const key = row.department && row.department.trim() !== '' ? row.department : 'OTHER';
            if (!groups[key]) {
                groups[key] = { rows: [], subtotal: 0 };
            }
            groups[key].rows.push(row);
            const value = typeof row.totalLeave === 'number' ? row.totalLeave : parseFloat(String(row.totalLeave));
            groups[key].subtotal += (isNaN(value) ? 0 : value);
        });
        return Object.entries(groups).sort((a, b) => String(a[0]).localeCompare(String(b[0])));
    }, [filteredData]);
    const topEmployees = useMemo(() => {
        if (!tableData) return [];
        return [...tableData]
            .sort((a, b) => b.totalLeave - a.totalLeave)
            .slice(0, 10);
    }, [tableData]);
    const topLeaveTypes = useMemo(() => {
        if (!tableData) return [];
        const leaveTypeTotals = {
            'Vacation': 0,
            'Sick Leave': 0,
            'Personal Leave': 0,
            'Birthday Leave': 0,
            'Other Leave': 0,
        };
        tableData.forEach(row => {
            leaveTypeTotals['Vacation'] += row.vacationUsed;
            leaveTypeTotals['Sick Leave'] += row.sickLeave;
            leaveTypeTotals['Personal Leave'] += row.personalLeave;
            leaveTypeTotals['Birthday Leave'] += row.birthdayLeave;
            leaveTypeTotals['Other Leave'] += row.otherLeave;
        });
        return Object.entries(leaveTypeTotals)
            .map(([name, total]) => ({ name, total }))
            .sort((a, b) => b.total - a.total);
    }, [tableData]);
    const topDepartments = useMemo(() => {
        if (!tableData) return [];
        const departmentTotals = {};
        tableData.forEach(row => {
            if (row.department) {
                departmentTotals[row.department] = (departmentTotals[row.department] || 0) + row.totalLeave;
            }
        });
        return Object.entries(departmentTotals)
            .map(([name, total]) => ({ name, total }))
            .sort((a, b) => b.total - a.total)
            .slice(0, 5);
    }, [tableData]);
    return (
        <div className="container mx-auto">
             <div className="flex justify-end items-center mb-6">
                <input
                    type="file"
                    ref={fileInputRef}
                    onChange={handleFileChange}
                    className="hidden"
                    accept=".xlsx, .xls"
                />
                <button
                    onClick={handleUploadClick}
                    className="flex items-center gap-2 bg-brand-primary text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-500 transition-colors duration-300"
                    aria-label="Upload Leave Excel file"
                >
                    <ArrowUpTrayIcon className="h-5 w-5" />
                    <span>{t('uploadExcel')}</span>
                </button>
            </div>
            {tableData.length > 0 ? (
                <div className="flex flex-col gap-8">
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        {kpis.map((kpi, index) => (
                            <KPICard
                                key={index}
                                title={kpi.title}
                                value={kpi.value}
                                icon={kpi.icon}
                                color={kpi.color}
                            />
                        ))}
                    </div>
                    <MainChart data={chartData} title={t('monthlyLeaveDays')} theme={theme}/>
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                            <div className="p-6 border-b border-light-border dark:border-dark-border">
                                <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('top10LeaveEmployees')}</h3>
                            </div>
                            <div className="overflow-auto">
                                <table className="w-full text-left">
                                    <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                                        <tr className="border-b border-light-border dark:border-dark-border">
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">#</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">{t('name')}</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">{t('department')}</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">{t('days')}</th>
                                        </tr>
                                    </thead>
                                    <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                                        {topEmployees.map((employee, index) => (
                                            <tr key={employee.employeeId} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary font-medium">{index + 1}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary max-w-[120px] truncate" title={employee.name}>{employee.name}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary">{employee.department}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-right font-semibold">{employee.totalLeave.toFixed(2)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                            <div className="p-6 border-b border-light-border dark:border-dark-border">
                                <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('top5LeaveTypes')}</h3>
                            </div>
                            <div className="overflow-auto">
                                <table className="w-full text-left">
                                    <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                                        <tr className="border-b border-light-border dark:border-dark-border">
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">#</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">{t('leaveType')}</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">{t('days')}</th>
                                        </tr>
                                    </thead>
                                    <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                                        {topLeaveTypes.map((leaveType, index) => (
                                            <tr key={leaveType.name} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary font-medium">{index + 1}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary">{leaveType.name}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-right font-semibold">{leaveType.total.toFixed(2)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                            <div className="p-6 border-b border-light-border dark:border-dark-border">
                                <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('top5LeaveDepartments')}</h3>
                            </div>
                            <div className="overflow-auto">
                                <table className="w-full text-left">
                                    <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                                        <tr className="border-b border-light-border dark:border-dark-border">
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">#</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase">{t('department')}</th>
                                            <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">{t('days')}</th>
                                        </tr>
                                    </thead>
                                    <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                                        {topDepartments.map((dept, index) => (
                                            <tr key={dept.name} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary font-medium">{index + 1}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary">{dept.name}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-right font-semibold">{dept.total.toFixed(2)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                        <div className="p-6 border-b border-light-border dark:border-dark-border flex justify-between items-center flex-wrap gap-4">
                            <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('employeeLeaveDetails')}</h3>
                            <div className="relative">
                                <MagnifyingGlassIcon className="h-5 w-5 absolute top-1/2 left-3 -translate-y-1/2 text-light-text-secondary dark:text-dark-text-secondary" />
                                <input
                                    type="text"
                                    placeholder={t('searchEmployees')}
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg pl-10 pr-4 py-2 text-light-text-primary dark:text-dark-text-primary focus:outline-none focus:ring-2 focus:ring-brand-primary w-full sm:w-64"
                                />
                            </div>
                        </div>
                        <div className="overflow-auto max-h-[600px]">
                            <table className="w-full text-left min-w-[2800px]">
                                <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                                    <tr className="border-b border-light-border dark:border-dark-border">
                                        {headers.map(header => (
                                            <th key={header} className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase whitespace-nowrap">{header}</th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                                    {filteredData.length > 0 ? (
                                        groupedByDepartment.map(([dept, group]) => (
                                            <React.Fragment key={dept}>
                                                <tr className="bg-slate-50/60 dark:bg-dark-bg/50">
                                                    <td colSpan={headers.length} className="p-4">
                                                        <div className="flex items-center justify-between">
                                                            <span className="text-sm font-semibold text-light-text-primary dark:text-dark-text-primary">DEPT.: {dept}</span>
                                                            <span className="text-sm font-semibold text-brand-primary">{group.subtotal.toFixed(2)}</span>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {group.rows.map((row, idx) => (
                                                    <tr key={`${dept}-${row.employeeId}-${idx}`} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.id}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.employeeId}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap max-w-xs truncate" title={row.name}>{row.name}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.position}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.department}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-center">{row.grade}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-center">{row.status}</td>
                                                        {row.monthlyLeave.map((leave, i) => (
                                                            <td key={i} className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{leave.toFixed(2)}</td>
                                                        ))}
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.leaveWithoutVacation.toFixed(2)}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.totalLeaveWithVacation.toFixed(2)}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.vacationCarriedOver.toFixed(2)}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.vacationEntitlement.toFixed(2)}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.totalVacation.toFixed(2)}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.vacationUsed.toFixed(2)}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.vacationAccrued.toFixed(2)}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.sickLeave.toFixed(2)}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.personalLeave.toFixed(2)}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.birthdayLeave.toFixed(2)}</td>
                                                        <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.otherLeave.toFixed(2)}</td>
                                                        <td className="p-4 text-sm font-bold text-brand-primary whitespace-nowrap text-right">{row.totalLeave.toFixed(2)}</td>
                                                    </tr>
                                                ))}
                                            </React.Fragment>
                                        ))
                                    ) : (
                                        <tr>
                                            <td colSpan={headers.length} className="text-center p-8 text-light-text-secondary dark:text-dark-text-secondary">
                                                {t('noResultsFound')}
                                            </td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            ) : (
                <div className="mt-8 flex items-center justify-center bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg p-16">
                    <div className="text-center">
                        <DocumentTextIcon className="mx-auto h-12 w-12 text-light-text-secondary dark:text-dark-text-secondary" />
                        <h3 className="mt-4 text-lg font-medium text-light-text-primary dark:text-dark-text-primary">{t('noDataLoaded')}</h3>
                        <p className="mt-1 text-sm text-light-text-secondary dark:text-dark-text-secondary">
                            {t('noDataLoadedMessageLeave')}
                        </p>
                    </div>
                </div>
            )}
        </div>
    );
};
// ===================================================
// END: components/LeaveReport.tsx
// ===================================================


// ===================================================
// START: components/AccidentReport.tsx
// ===================================================
const AccidentReport = ({ tableData, kpis, chartData, onFileUpload, theme }) => {
    const { t } = useTranslation();
    const fileInputRef = useRef(null);
    const [searchTerm, setSearchTerm] = useState('');
    const handleUploadClick = () => {
        fileInputRef.current?.click();
    };
    const handleFileChange = (event) => {
        const file = event.target.files?.[0];
        if (file) {
            onFileUpload(file);
        }
    };
    const headers = ['‡∏•‡∏≥‡∏î‡∏±‡∏ö', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏', '‡πÄ‡∏ß‡∏•‡∏≤', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á', '‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà', '‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô', '‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', '‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•', '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á', '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î', '‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏', '‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢', '‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏°', '‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', '‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©', '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà'];
    const filteredData = tableData.filter(row =>
        Object.values(row).some(value =>
            String(value).toLowerCase().includes(searchTerm.toLowerCase())
        )
    );
    return (
        <div className="container mx-auto">
             <div className="flex justify-end items-center mb-6">
                <input
                    type="file"
                    ref={fileInputRef}
                    onChange={handleFileChange}
                    className="hidden"
                    accept=".xlsx, .xls"
                />
                <button
                    onClick={handleUploadClick}
                    className="flex items-center gap-2 bg-brand-primary text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-500 transition-colors duration-300"
                    aria-label="Upload Accident Excel file"
                >
                    <ArrowUpTrayIcon className="h-5 w-5" />
                    <span>{t('uploadExcel')}</span>
                </button>
            </div>
            {tableData.length > 0 ? (
                <>
                    <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 mb-8">
                        {kpis.map((kpi, index) => (
                            <KPICard
                                key={index}
                                title={kpi.title}
                                value={kpi.value}
                                icon={kpi.icon}
                                color={kpi.color}
                            />
                        ))}
                    </div>
                    <div className="mb-8 bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg p-6">
                        <MainChart data={chartData} title={t('accidentsByDepartment')} theme={theme} />
                    </div>
                    <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                        <div className="p-6 border-b border-light-border dark:border-dark-border flex justify-between items-center flex-wrap gap-4">
                            <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('accidentDetails')}</h3>
                            <div className="relative">
                                <MagnifyingGlassIcon className="h-5 w-5 absolute top-1/2 left-3 -translate-y-1/2 text-light-text-secondary dark:text-dark-text-secondary" />
                                <input
                                    type="text"
                                    placeholder={t('searchAccidents')}
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg pl-10 pr-4 py-2 text-light-text-primary dark:text-dark-text-primary focus:outline-none focus:ring-2 focus:ring-brand-primary w-full sm:w-64"
                                />
                            </div>
                        </div>
                        <div className="overflow-auto max-h-[600px]">
                            <table className="w-full text-left min-w-[3200px]">
                                <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                                    <tr className="border-b border-light-border dark:border-dark-border">
                                        {headers.map(header => (
                                            <th key={header} className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase whitespace-nowrap">{header}</th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                                    {filteredData.length > 0 ? (
                                        filteredData.map((row) => (
                                            <tr key={row.id} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.id}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.incidentDate}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.incidentTime}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.severity}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-center">{row.occurrence}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.department}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.employeeId}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap max-w-xs truncate" title={row.employeeName}>{row.employeeName}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap max-w-xs truncate" title={row.position}>{row.position}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-normal max-w-md">{row.details}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-normal max-w-md">{row.cause}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-normal max-w-md">{row.prevention}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap text-right">{row.damageValue.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.insuranceClaim}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-normal max-w-md">{row.actionTaken}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-normal max-w-xs">{row.penalty}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.remarks}</td>
                                                <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary whitespace-nowrap">{row.accidentLocation}</td>
                                            </tr>
                                        ))
                                    ) : (
                                        <tr>
                                            <td colSpan={headers.length} className="text-center p-8 text-light-text-secondary dark:text-dark-text-secondary">
                                                {t('noResultsFound')}
                                            </td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </>
            ) : (
                <div className="mt-8 flex items-center justify-center bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg p-16">
                    <div className="text-center">
                        <DocumentTextIcon className="mx-auto h-12 w-12 text-light-text-secondary dark:text-dark-text-secondary" />
                        <h3 className="mt-4 text-lg font-medium text-light-text-primary dark:text-dark-text-primary">{t('noDataLoaded')}</h3>
                        <p className="mt-1 text-sm text-light-text-secondary dark:text-dark-text-secondary">
                            {t('noDataLoadedMessageAccident')}
                        </p>
                    </div>
                </div>
            )}
        </div>
    );
};
// ===================================================
// END: components/AccidentReport.tsx
// ===================================================


// ===================================================
// START: components/WorkloadReport.tsx
// ===================================================
const WorkloadReport = ({ data, theme, onFileUpload }) => {
    const { t } = useTranslation();
    const fileInputRef = useRef(null);
    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const gridColor = theme === 'dark' ? '#334155' : '#E2E8F0';
    const tickColor = theme === 'dark' ? '#94A3B8' : '#64748B';

    const handleUploadClick = () => {
        fileInputRef.current?.click();
    };

    const handleFileChange = (event) => {
        const file = event.target.files?.[0];
        if (file) {
            onFileUpload(file);
        }
    };
    
    const { summaryKpis, chartData } = useMemo(() => {
        if (!data || data.length === 0) {
            return { summaryKpis: [], chartData: [] };
        }

        const getTonPerHrSumForProduct = (productIndex) => {
            if (productIndex === -1 || !data[productIndex + 1]) return [];
            const tonHrSection = data[productIndex + 1];
            if (tonHrSection && tonHrSection.product === 'Ton/Person/Hr.' && tonHrSection.isSubProduct) {
                const sumRow = tonHrSection.rows.find(r => r.description === 'Sum');
                return sumRow ? sumRow.values : [];
            }
            return [];
        };

        const rawMaterialIndex = data.findIndex(p => p.product === 'Raw Material');
        const coilIndex = data.findIndex(p => p.product === 'Coil');
        const filmScrapIndex = data.findIndex(p => p.product === 'Film&Scrap');
        
        const rawMaterialTonHr = getTonPerHrSumForProduct(rawMaterialIndex);
        const coilTonHr = getTonPerHrSumForProduct(coilIndex);
        const filmTonHr = getTonPerHrSumForProduct(filmScrapIndex);

        const avg = (arr) => {
            if (!arr) return 0;
            const filtered = arr.filter(v => v !== null);
            if(filtered.length === 0) return 0;
            return filtered.reduce((a, b) => a + b, 0) / filtered.length;
        };
        
        const _summaryKpis = [
            { title: t('avgWorkloadRaw'), value: avg(rawMaterialTonHr).toFixed(2), icon: 'UserGroupIcon', color: 'text-brand-success' },
            { title: t('avgWorkloadCoil'), value: avg(coilTonHr).toFixed(2), icon: 'UserGroupIcon', color: 'text-brand-primary' },
            { title: t('avgWorkloadFilm'), value: avg(filmTonHr).toFixed(2), icon: 'UserGroupIcon', color: 'text-brand-warning' },
        ];

        const _chartData = monthNames.map((month, index) => ({
            month,
            'Raw Material': rawMaterialTonHr[index] || 0,
            'Coil': coilTonHr[index] || 0,
            'Film & Scrap': filmTonHr[index] || 0,
        }));

        return { summaryKpis: _summaryKpis, chartData: _chartData };

    }, [data, t]);


    const formatNumber = (num) => {
        if (num === null || num === undefined) return '-';
        return num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    };

    return (
        <div className="container mx-auto flex flex-col gap-8">
            <div className="flex justify-end items-center">
                <input
                    type="file"
                    ref={fileInputRef}
                    onChange={handleFileChange}
                    className="hidden"
                    accept=".xlsx, .xls"
                />
                <button
                    onClick={handleUploadClick}
                    className="flex items-center gap-2 bg-brand-primary text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-500 transition-colors duration-300"
                    aria-label="Upload Workload Excel file"
                >
                    <ArrowUpTrayIcon className="h-5 w-5" />
                    <span>{t('uploadExcel')}</span>
                </button>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                {summaryKpis.map((kpi, index) => (
                    <KPICard
                        key={index}
                        title={kpi.title}
                        value={kpi.value}
                        icon={kpi.icon}
                        color={kpi.color}
                    />
                ))}
            </div>
             <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl p-6 h-[480px] shadow-lg">
                <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary mb-6">{t('workloadByProduct')}</h3>
                <ResponsiveContainer width="100%" height="90%">
                    <LineChart data={chartData} margin={{ top: 5, right: 20, left: -10, bottom: 5 }}>
                        <CartesianGrid strokeDasharray="3 3" stroke={gridColor}/>
                        <XAxis dataKey="month" stroke={tickColor} tick={{ fill: tickColor }} />
                        <YAxis stroke={tickColor} tick={{ fill: tickColor }}/>
                        <Tooltip contentStyle={{
                            backgroundColor: theme === 'dark' ? '#1E293B' : '#FFFFFF',
                            borderColor: theme === 'dark' ? '#334155' : '#E2E8F0',
                            color: theme === 'dark' ? '#F8FAFC' : '#0F172A'
                        }}/>
                        <Legend wrapperStyle={{ color: tickColor }} />
                        <Line type="monotone" dataKey="Raw Material" stroke="#10B981" strokeWidth={2} />
                        <Line type="monotone" dataKey="Coil" stroke="#6366F1" strokeWidth={2} />
                        <Line type="monotone" dataKey="Film & Scrap" stroke="#F59E0B" strokeWidth={2} />
                    </LineChart>
                </ResponsiveContainer>
            </div>
            <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg flex flex-col">
                 <div className="p-6 border-b border-light-border dark:border-dark-border">
                    <h3 className="text-xl font-bold text-light-text-primary dark:text-dark-text-primary">{t('workloadDetails')}</h3>
                </div>
                <div className="overflow-x-auto">
                    <table className="w-full text-left min-w-[1600px]">
                        <thead className="sticky top-0 bg-light-card dark:bg-dark-card z-10">
                            <tr className="border-b border-light-border dark:border-dark-border">
                                <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase w-1/5">{t('product')}</th>
                                <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase w-1/4">{t('description')}</th>
                                <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase w-[80px]">{t('unit')}</th>
                                {monthNames.map(m => <th key={m} className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">{m}</th>)}
                                <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">AVERAGE</th>
                                <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">MIN</th>
                                <th className="p-4 text-sm font-semibold text-light-text-secondary dark:text-dark-text-secondary uppercase text-right">MAX</th>
                            </tr>
                        </thead>
                        <tbody className='divide-y divide-light-border dark:divide-dark-border'>
                           {data.map((productSection, sectionIndex) => (
                                <React.Fragment key={sectionIndex}>
                                    {!productSection.isSubProduct && (
                                        <tr className="bg-slate-50 dark:bg-dark-bg/50">
                                            <td colSpan={18} className="p-4 font-bold text-lg text-brand-primary">
                                                {productSection.product}
                                            </td>
                                        </tr>
                                    )}
                                    {productSection.rows.map((row, rowIndex) => (
                                        <tr key={`${sectionIndex}-${rowIndex}`} className="hover:bg-slate-50 dark:hover:bg-dark-bg/50 transition-colors">
                                             <td>
                                                {productSection.isSubProduct && rowIndex === 0 &&
                                                    <div className="p-4 font-bold text-light-text-primary dark:text-dark-text-primary">{productSection.product}</div>
                                                }
                                            </td>
                                            <td className={`p-4 text-sm ${row.isSubRow ? 'pl-8' : 'font-semibold'} text-light-text-primary dark:text-dark-text-primary`}>{row.description}</td>
                                            <td className="p-4 text-sm text-light-text-secondary dark:text-dark-text-secondary">{row.unit}</td>
                                            {row.values.map((val, i) => <td key={i} className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-right whitespace-nowrap">{formatNumber(val)}</td>)}
                                            <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-right whitespace-nowrap font-medium">{formatNumber(row.average)}</td>
                                            <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-right whitespace-nowrap font-medium">{formatNumber(row.min)}</td>
                                            <td className="p-4 text-sm text-light-text-primary dark:text-dark-text-primary text-right whitespace-nowrap font-medium">{formatNumber(row.max)}</td>
                                        </tr>
                                    ))}
                                </React.Fragment>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    );
};
// ===================================================
// END: components/WorkloadReport.tsx
// ===================================================

// ===================================================
// START: components/Sidebar.tsx
// ===================================================
const NavLink = ({ icon, text, active, onClick }) => (
  <button
    onClick={onClick}
    className={`flex items-center w-full px-4 py-3 text-lg rounded-lg transition-colors duration-200 text-left ${
      active
        ? 'bg-brand-primary text-white font-semibold shadow-lg'
        : 'text-light-text-secondary dark:text-dark-text-secondary hover:bg-slate-100 dark:hover:bg-dark-card hover:text-light-text-primary dark:hover:text-dark-text-primary'
    }`}
    aria-current={active ? 'page' : undefined}
  >
    <span className="mr-4">{icon}</span>
    {text}
  </button>
);
const Sidebar = ({ activePage, onNavigate, isOpen, onClose }) => {
  const { t } = useTranslation();
  const navItems = [
    { key: 'kpiReport', icon: <HomeIcon className="h-6 w-6" /> },
    { key: 'consumablesReport', icon: <ClipboardDocumentListIcon className="h-6 w-6" /> },
    { key: 'otReport', icon: <ClockIcon className="h-6 w-6" /> },
    { key: 'leaveReport', icon: <CalendarDaysIcon className="h-6 w-6" /> },
    { key: 'accidentReport', icon: <ExclamationTriangleIcon className="h-6 w-6" /> },
    { key: 'workloadReport', icon: <UserGroupIcon className="h-6 w-6" /> },
    { key: 'reports', icon: <ChartPieIcon className="h-6 w-6" /> },
    { key: 'documents', icon: <DocumentTextIcon className="h-6 w-6" /> },
    { key: 'settings', icon: <Cog6ToothIcon className="h-6 w-6" /> },
  ];
  return (
    <aside className={`fixed inset-y-0 left-0 z-50 w-64 flex-shrink-0 bg-light-card dark:bg-dark-card border-r border-light-border dark:border-dark-border p-6 flex flex-col transform transition-transform duration-300 ease-in-out lg:relative lg:translate-x-0 ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}>
      <div className="flex items-center justify-between mb-10">
        <div className="flex items-center">
            <BoltIcon className="h-10 w-10 text-brand-primary" />
            <span className="text-2xl font-bold ml-3 text-light-text-primary dark:text-dark-text-primary">{t('analytics')}</span>
        </div>
        <button onClick={onClose} className="lg:hidden text-light-text-secondary dark:text-dark-text-secondary">
            <XMarkIcon className="h-6 w-6" />
        </button>
      </div>
      <nav className="flex-1 flex flex-col gap-3">
        {navItems.map((item) => (
          <NavLink
            key={item.key}
            icon={item.icon}
            text={t(item.key)}
            active={activePage === item.key}
            onClick={() => onNavigate(item.key)}
          />
        ))}
      </nav>
      <div className="mt-auto">
        <NavLink 
          icon={<QuestionMarkCircleIcon className="h-6 w-6" />} 
          text={t('helpCenter')}
          active={activePage === 'helpCenter'}
          onClick={() => onNavigate('helpCenter')}
        />
      </div>
    </aside>
  );
};
// ===================================================
// END: components/Sidebar.tsx
// ===================================================


// ===================================================
// START: components/Header.tsx
// ===================================================
const Header = ({ onFileUpload, activePage, theme, toggleTheme, onMenuClick, onShareReport, onLoadReport, onLoadFromFirestore, onClearData }) => {
  const { t, language, toggleLanguage } = useTranslation();
  const fileInputRef = useRef(null);
  const loadReportInputRef = useRef(null);

  const handleUploadClick = () => {
    fileInputRef.current?.click();
  };

  const handleFileChange = (event) => {
    const file = event.target.files?.[0];
    if (file) {
      onFileUpload(file);
    }
  };

  const handleLoadClick = () => {
    loadReportInputRef.current?.click();
  };

  const handleLoadFileChange = (event) => {
    const file = event.target.files?.[0];
    if (file) {
        onLoadReport(file);
    }
    if (event.target) {
        event.target.value = null;
    }
  };

  return (
    <header className="bg-light-card dark:bg-dark-card border-b border-light-border dark:border-dark-border p-4 shadow-sm flex items-center justify-between">
      <div className="flex items-center">
         <button onClick={onMenuClick} className="lg:hidden mr-4 text-light-text-secondary dark:text-dark-text-secondary" aria-label="Open menu">
            <Bars3Icon className="h-6 w-6" />
        </button>
        <h1 className="text-2xl font-bold text-light-text-primary dark:text-dark-text-primary">{t(activePage)}</h1>
      </div>
      <div className="flex items-center gap-4">
        <div className="relative hidden md:block">
          <MagnifyingGlassIcon className="h-5 w-5 absolute top-1/2 left-3 -translate-y-1/2 text-light-text-secondary dark:text-dark-text-secondary" />
          <input
            type="text"
            placeholder={t('search')}
            className="bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border rounded-lg pl-10 pr-4 py-2 text-light-text-primary dark:text-dark-text-primary focus:outline-none focus:ring-2 focus:ring-brand-primary"
          />
        </div>
        {activePage === 'kpiReport' && (
          <>
            <input
                type="file"
                ref={fileInputRef}
                onChange={handleFileChange}
                className="hidden"
                accept=".xlsx, .xls"
            />
            <button 
                onClick={handleUploadClick}
                className="flex items-center justify-center bg-brand-primary text-white font-semibold p-3 rounded-lg hover:bg-indigo-500 transition-colors duration-300"
                aria-label="Upload KPI data file"
                title="‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• KPI"
            >
                <ArrowUpTrayIcon className="h-5 w-5" />
            </button>
          </>
        )}
        <input
            type="file"
            ref={loadReportInputRef}
            onChange={handleLoadFileChange}
            className="hidden"
            accept=".json"
        />
        <button
          onClick={handleLoadClick}
          className="text-light-text-secondary dark:text-dark-text-secondary hover:text-light-text-primary dark:hover:text-dark-text-primary transition-colors"
          aria-label={t('loadReport')}
          title={t('loadReport')}
        >
          <ArrowDownTrayIcon className="h-6 w-6" />
        </button>
        <button
          onClick={onLoadFromFirestore}
          className="flex items-center justify-center bg-green-600 text-white font-semibold p-3 rounded-lg hover:bg-green-700 transition-colors duration-300"
          aria-label="‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firestore"
          title="‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Firestore"
        >
          <ArrowPathIcon className="h-5 w-5" />
        </button>
        <button
          onClick={onClearData}
          className="flex items-center justify-center bg-red-600 text-white font-semibold p-3 rounded-lg hover:bg-red-700 transition-colors duration-300"
          aria-label="‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Firestore"
          title="‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Firestore"
        >
          <TrashIcon className="h-5 w-5" />
        </button>
        <button
          onClick={onShareReport}
          className="text-light-text-secondary dark:text-dark-text-secondary hover:text-light-text-primary dark:hover:text-dark-text-primary transition-colors"
          aria-label={t('shareReport')}
          title={t('shareReport')}
        >
          <ShareIcon className="h-6 w-6" />
        </button>
        <button
          onClick={toggleTheme}
          className="text-light-text-secondary dark:text-dark-text-secondary hover:text-light-text-primary dark:hover:text-dark-text-primary transition-colors"
          aria-label={`Switch to ${theme === 'dark' ? 'light' : 'dark'} mode`}
        >
          {theme === 'dark' ? <SunIcon className="h-6 w-6" /> : <MoonIcon className="h-6 w-6" />}
        </button>
        <button
          onClick={toggleLanguage}
          className="text-light-text-secondary dark:text-dark-text-secondary hover:text-light-text-primary dark:hover:text-dark-text-primary transition-colors font-semibold text-sm w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-dark-border"
          aria-label="Toggle language"
        >
          {language === 'en' ? 'TH' : 'EN'}
        </button>
        <button className="relative text-light-text-secondary dark:text-dark-text-secondary hover:text-light-text-primary dark:hover:text-dark-text-primary transition-colors">
          <BellIcon className="h-6 w-6" />
          <span className="absolute -top-1 -right-1 flex h-3 w-3">
            <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand-secondary opacity-75"></span>
            <span className="relative inline-flex rounded-full h-3 w-3 bg-brand-secondary"></span>
          </span>
        </button>
        <div className="flex items-center gap-3">
            <img
                src="https://picsum.photos/seed/user1/40/40"
                alt="User Avatar"
                className="h-10 w-10 rounded-full border-2 border-brand-primary"
            />
            <div className='hidden sm:block'>
                <p className="font-semibold text-light-text-primary dark:text-dark-text-primary">{t('userName')}</p>
                <p className="text-sm text-light-text-secondary dark:text-dark-text-secondary">{t('userRole')}</p>
            </div>
        </div>
      </div>
    </header>
  );
};
// ===================================================
// END: components/Header.tsx
// ===================================================

// ===================================================
// START: LoadingSpinner.tsx
// ===================================================
const LoadingSpinner = () => {
    const { t } = useTranslation();
    return (
        <div className="flex flex-col items-center justify-center h-screen w-full bg-light-bg dark:bg-dark-bg">
            <div className="flex items-center">
                <BoltIcon className="h-16 w-16 text-brand-primary animate-pulse" />
                <span className="text-3xl font-bold ml-4 text-light-text-secondary dark:text-dark-text-secondary">Loading Dashboard...</span>
            </div>
            <p className="mt-4 text-light-text-secondary dark:text-dark-text-secondary">Please wait while we fetch your data.</p>
        </div>
    );
};
// ===================================================
// END: LoadingSpinner.tsx
// ===================================================


// ===================================================
// START: App.tsx
// ===================================================
const PlaceholderPage = ({ title }) => {
    const { t } = useTranslation();
    return (
        <div className="flex items-center justify-center h-full w-full">
            <div className="text-center">
            <h1 className="text-4xl font-bold text-light-text-secondary dark:text-dark-text-secondary tracking-tight">{title}</h1>
            <p className="mt-2 text-lg text-light-text-secondary dark:text-dark-text-secondary">{t('underConstruction')}</p>
            </div>
        </div>
    );
};

const App = () => {
  const { t } = useTranslation();
  
  // Shared Data State
  const [kpis, setKpis] = useState([]);
  const [chartData, setChartData] = useState([]);
  const [tableRows, setTableRows] = useState([]);
  const [consumablesTableData, setConsumablesTableData] = useState([]);
  const [consumablesKpis, setConsumablesKpis] = useState([]);
  const [consumablesChartData, setConsumablesChartData] = useState([]);
  const [otTableData, setOtTableData] = useState([]);
  const [otKpis, setOtKpis] = useState([]);
  const [otChartData, setOtChartData] = useState([]);
  const [leaveTableData, setLeaveTableData] = useState([]);
  const [leaveKpis, setLeaveKpis] = useState([]);
  const [leaveChartData, setLeaveChartData] = useState([]);
  const [accidentTableData, setAccidentTableData] = useState([]);
  const [accidentKpis, setAccidentKpis] = useState([]);
  const [accidentChartData, setAccidentChartData] = useState([]);
  const [workloadReportData, setWorkloadReportData] = useState([]);
  
  // UI State
  const [isLoading, setIsLoading] = useState(true);
  const [activePage, setActivePage] = useState(getInitialState('activePage', 'kpiReport'));
  const [theme, setTheme] = useState(getInitialState('theme', 'dark'));
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);

  const toggleTheme = () => {
      setTheme(prevTheme => (prevTheme === 'dark' ? 'light' : 'dark'));
  };

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° "‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡πÉ‡∏ô Header
  const handleClearAllData = async () => {
    try {
      // ‡πÅ‡∏°‡∏õ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏±‡∏ö collection ‡πÅ‡∏•‡∏∞ state setters
      const pageCollectionMap = {
        kpiReport: {
          collection: 'kpi_reports',
          name: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô KPI',
          clearStates: () => {
            setKpis([]);
            setChartData([]);
            setTableRows([]);
          }
        },
        consumablesReport: {
          collection: 'consumables_reports',
          name: '‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á',
          clearStates: () => {
            setConsumablesTableData([]);
            setConsumablesKpis([]);
            setConsumablesChartData([]);
          }
        },
        otReport: {
          collection: 'ot_reports',
          name: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô OT',
          clearStates: () => {
            setOtTableData([]);
            setOtKpis([]);
            setOtChartData([]);
          }
        },
        leaveReport: {
          collection: 'leave_reports',
          name: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤',
          clearStates: () => {
            setLeaveTableData([]);
            setLeaveKpis([]);
            setLeaveChartData([]);
          }
        },
        accidentReport: {
          collection: 'accident_reports',
          name: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏',
          clearStates: () => {
            setAccidentTableData([]);
            setAccidentKpis([]);
            setAccidentChartData([]);
          }
        },
        workloadReport: {
          collection: 'workload_reports',
          name: '‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô',
          clearStates: () => {
            setWorkloadReportData([]);
          }
        }
      };

      // ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      const currentPage = pageCollectionMap[activePage];
      
      if (!currentPage) {
        alert('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ');
        return;
      }

      // ‡∏Ç‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö
      const confirmed = window.confirm(
        `‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á "${currentPage.name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!`
      );
      
      if (!confirmed) {
        return;
      }

      // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firestore
      const cleared = await clearFirestoreCollection(currentPage.collection);
      if (cleared) {
        // ‡∏•‡πâ‡∏≤‡∏á state ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        currentPage.clearStates();
        alert(`‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "${currentPage.name}" ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
      } else {
        alert(`‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "${currentPage.name}" ‡πÑ‡∏î‡πâ ‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á`);
      }
    } catch (error) {
      console.error('Error clearing Firestore data:', error);
      alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
    }
  };

  useEffect(() => {
    const root = window.document.documentElement;
    const isDark = theme === 'dark';
    root.classList.remove(isDark ? 'light' : 'dark');
    root.classList.add(theme);
    localStorage.setItem('theme', JSON.stringify(theme));
  }, [theme]);

  useEffect(() => {
    localStorage.setItem('activePage', JSON.stringify(activePage));
  }, [activePage]);

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô wrapper ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firestore
  const loadDataFromFirestore = async () => {
    const stateSetters = {
      setKpis, setChartData, setTableRows,
      setConsumablesTableData, setConsumablesKpis, setConsumablesChartData,
      setOtTableData, setOtKpis, setOtChartData,
      setLeaveTableData, setLeaveKpis, setLeaveChartData,
      setAccidentTableData, setAccidentKpis, setAccidentChartData,
      setWorkloadReportData
    };
    return await loadLatestDataFromFirestore(stateSetters);
  };

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° "‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡πÉ‡∏ô Header
  const handleLoadFromFirestore = async () => {
    try {
      const loaded = await loadDataFromFirestore();
      if (loaded) {
        alert('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Firestore ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
      } else {
        alert('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Firestore ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
      }
    } catch (error) {
      console.error('Error loading from Firestore:', error);
      alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
    }
  };

  useEffect(() => {
    const fetchData = async () => {
      try {
        // ‡∏£‡∏≠‡πÉ‡∏´‡πâ Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô
        let attempts = 0;
        while (!firebaseConnected && attempts < 10) {
          await new Promise(resolve => setTimeout(resolve, 500));
          attempts++;
        }

        if (firebaseConnected) {
          // ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firestore ‡∏Å‡πà‡∏≠‡∏ô
          const firestoreLoaded = await loadDataFromFirestore();
          
          if (!firestoreLoaded) {
            // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Firestore ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å mockApi ‡πÅ‡∏ó‡∏ô
            console.log('üîÑ Fallback to loading mock data...');
            const data = await mockApi.getData();
            setKpis(data.kpiData.kpis);
            setChartData(data.kpiData.chartData);
            setTableRows(data.kpiData.tableRows);
            setConsumablesTableData(data.consumablesData.tableData);
            setConsumablesKpis(data.consumablesData.kpis);
            setConsumablesChartData(data.consumablesData.chartData);
            setOtTableData(data.otData.tableData);
            setOtKpis(data.otData.kpis);
            setOtChartData(data.otData.chartData);
            setLeaveTableData(data.leaveData.tableData);
            setLeaveKpis(data.leaveData.kpis);
            setLeaveChartData(data.leaveData.chartData);
            setAccidentTableData(data.accidentData.tableData);
            setAccidentKpis(data.accidentData.kpis);
            setAccidentChartData(data.accidentData.chartData);
            setWorkloadReportData(data.workloadData.data);
          }
        } else {
          // ‡∏ñ‡πâ‡∏≤ Firebase ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î mock data
          console.log('üîÑ Firebase not connected, loading mock data...');
          const data = await mockApi.getData();
          setKpis(data.kpiData.kpis);
          setChartData(data.kpiData.chartData);
          setTableRows(data.kpiData.tableRows);
          setConsumablesTableData(data.consumablesData.tableData);
          setConsumablesKpis(data.consumablesData.kpis);
          setConsumablesChartData(data.consumablesData.chartData);
          setOtTableData(data.otData.tableData);
          setOtKpis(data.otData.kpis);
          setOtChartData(data.otData.chartData);
          setLeaveTableData(data.leaveData.tableData);
          setLeaveKpis(data.leaveData.kpis);
          setLeaveChartData(data.leaveData.chartData);
          setAccidentTableData(data.accidentData.tableData);
          setAccidentKpis(data.accidentData.kpis);
          setAccidentChartData(data.accidentData.chartData);
          setWorkloadReportData(data.workloadData.data);
        }
      } catch (error) {
        console.error("Failed to fetch initial data:", error);
        alert("Could not load dashboard data. Please refresh the page.");
      } finally {
        setIsLoading(false);
      }
    };
    fetchData();
  }, []);

  const handleNavigate = (page) => {
    setActivePage(page);
    setIsSidebarOpen(false);
  };
  
  const handleShareReport = () => {
    try {
        const dbData = localStorage.getItem(DB_STORAGE_KEY);
        if (!dbData) {
            alert("No data available to share.");
            return;
        }
        const blob = new Blob([dbData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        const timestamp = new Date().toISOString().replace(/:/g, '-');
        a.href = url;
        a.download = `kpi-dashboard-export-${timestamp}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    } catch (error) {
        console.error("Error sharing report:", error);
        alert("Could not share the report. An error occurred.");
    }
  };

  const handleLoadReport = (file) => {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const text = e.target.result;
            const data = JSON.parse(text);

            // Basic validation
            if (typeof data !== 'object' || data === null || !data.kpiData || !data.consumablesData) {
                throw new Error("Invalid or corrupted file format.");
            }

            localStorage.setItem(DB_STORAGE_KEY, JSON.stringify(data));
            alert("Report loaded successfully! The page will now reload.");
            window.location.reload();
        } catch (error) {
            console.error("Error loading report:", error);
            alert(`Failed to load the report file. Error: ${error.message}`);
        }
    };
    reader.readAsText(file);
  };

  const handleDashboardFileUpload = (file) => {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const data = e.target?.result;
            const workbook = read(data, { type: 'binary' });
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            const json = utils.sheet_to_json(worksheet, { header: 1 });
            const rows = json.slice(1);
            if (rows.length === 0) {
                alert("Excel sheet is empty or invalid.");
                return;
            }
            const newKpis = [];
            const newTableRows = [];
            const monthCols = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            rows.forEach((row, index) => {
                if (!row || row.length < 22 || !row[1]) return;
                
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà
                const kpiNo = row[0] ? String(row[0]) : 'N/A';
                const kpiTitle = row[1] ? String(row[1]) : 'Untitled KPI';
                const target = row[2] ? String(row[2]) : 'N/A';
                const targetMeasurement = row[3] ? String(row[3]) : 'N/A';
                const score = row[16] ? String(row[16]) : 'N/A';
                const result = row[17] ? String(row[17]) : 'N/A';
                const description = row[18] ? String(row[18]) : 'N/A';
                const objective = row[19] ? String(row[19]) : 'N/A';
                const measurementMethod = row[20] ? String(row[20]) : 'N/A';
                const responsible = row[21] ? String(row[21]) : 'N/A';
                const improvementPlan = row[22] ? String(row[22]) : 'N/A';
                
                newKpis.push({
                    title: kpiTitle,
                    value: modifySpecificKpiScore(kpiTitle, score),
                    target: target,
                    trend: result,
                    trendDirection: result.toUpperCase() === 'PASS' ? 'up' : 'down',
                    icon: getKpiIcon(kpiTitle),
                    color: kpiData[index % kpiData.length].color,
                });
                
                // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 4-15)
                const monthlyData = {};
                monthCols.forEach((month, monthIndex) => {
                    const monthValue = row[4 + monthIndex];
                    monthlyData[month] = monthValue ? String(monthValue) : 'N/A';
                });
                
                newTableRows.push({
                    kpiNo: kpiNo,
                    kpi: {
                        title: kpiTitle,
                        measurement: targetMeasurement,
                    },
                    target: target,
                    score: score,
                    result: result,
                    monthlyData: monthlyData,
                    description: description,
                    objective: objective,
                    measurementMethod: measurementMethod,
                    responsible: responsible,
                    improvementPlan: improvementPlan,
                });
            });
            const firstKpiRow = rows[0];
            const newChartData = monthCols.map((month, index) => {
                const rawValue = firstKpiRow[4 + index];
                let numericValue = 0;
                if (typeof rawValue === 'string') {
                    numericValue = parseFloat(rawValue.replace('%', ''));
                } else if (typeof rawValue === 'number') {
                    numericValue = rawValue;
                }
                return {
                    name: month,
                    value: isNaN(numericValue) ? 0 : numericValue,
                };
            });
            const payload = { kpis: newKpis, chartData: newChartData, tableRows: newTableRows };
            
            // Save to Firestore
            saveToFirestore('kpi_reports', {
                fileName: file.name,
                fileSize: file.size,
                uploadedAt: new Date().toISOString(),
                data: payload
            });
            
            mockApi.updateKpi(payload).then(updated => {
                setKpis(updated.kpis);
                setChartData(updated.chartData);
                setTableRows(updated.tableRows);
                setActivePage('kpiReport');
                alert('‚úÖ KPI data uploaded and saved to Firestore successfully!');
            });
        } catch (error) {
            console.error("Error processing Excel file:", error);
            alert("Failed to process the Excel file. Please ensure it's in the correct format.");
        }
    };
    reader.readAsBinaryString(file);
  };

  const handleConsumablesFileUpload = (file) => {
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const workbookData = e.target?.result;
            const workbook = read(workbookData, { type: 'binary' });
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            const json = utils.sheet_to_json(worksheet, { header: 1 });
            const rows = json.slice(1);
            if (rows.length === 0) {
                alert("Excel sheet is empty or invalid.");
                setConsumablesTableData([]);
                setConsumablesKpis([]);
                setConsumablesChartData([]);
                return;
            }
            const newReportData = rows.map(row => {
                if (!row || row.length < 9) return null;
                let date = row[0];
                if (typeof date === 'number') {
                    const excelEpoch = new Date(1899, 11, 30);
                    const jsDate = new Date(excelEpoch.getTime() + date * 86400000);
                    date = jsDate.toLocaleDateString('en-GB');
                } else if (date instanceof Date) {
                    date = date.toLocaleDateString('en-GB');
                }
                return {
                    date: String(date || ''),
                    material: String(row[1] || ''),
                    description: String(row[2] || ''),
                    quantity: String(row[3] || '0'),
                    unit: String(row[4] || ''),
                    price: String(row[5] || '0'),
                    totalPrice: String(row[6] || '0'),
                    costCenter: String(row[7] || ''),
                    department: String(row[8] || ''),
                };
            }).filter((item) => item !== null && item.date !== '');
            const totalCost = newReportData.reduce((acc, row) => {
                const price = parseFloat(String(row.totalPrice).replace(/[^0-9.-]+/g,""));
                return acc + (isNaN(price) ? 0 : price);
            }, 0);
            const uniqueItems = new Set(newReportData.map(row => row.material)).size;
            const uniqueDepartments = new Set(newReportData.map(row => row.department)).size;
            const totalTransactions = newReportData.length;
            const newKpis = [
                { title: 'Total Cost', value: `‡∏ø${totalCost.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`, icon: 'CurrencyDollarIcon', color: 'text-brand-success' },
                { title: 'Total Items', value: uniqueItems.toLocaleString(), icon: 'ArchiveBoxIcon', color: 'text-brand-primary' },
                { title: 'Departments', value: uniqueDepartments.toLocaleString(), icon: 'BuildingOfficeIcon', color: 'text-brand-warning' },
                { title: 'Transactions', value: totalTransactions.toLocaleString(), icon: 'DocumentTextIcon', color: 'text-brand-secondary' }
            ];
            const monthlyTotals = {};
            newReportData.forEach(row => {
                const dateParts = row.date.split('/');
                if (dateParts.length === 3) {
                    const month = parseInt(dateParts[1], 10) - 1;
                    const price = parseFloat(String(row.totalPrice).replace(/[^0-9.-]+/g, ""));
                    if (!isNaN(month) && month >= 0 && month < 12 && !isNaN(price)) {
                        monthlyTotals[month] = (monthlyTotals[month] || 0) + price;
                    }
                }
            });
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const newChartData = monthNames.map((name, index) => ({
                name,
                value: monthlyTotals[index] || 0,
            }));
            const payload = { tableData: newReportData, kpis: newKpis, chartData: newChartData };
            
            // Save to Firestore
            saveToFirestore('consumables_reports', {
                fileName: file.name,
                fileSize: file.size,
                uploadedAt: new Date().toISOString(),
                data: payload
            });
            
            mockApi.updateConsumables(payload).then(updated => {
                setConsumablesChartData(updated.chartData);
                setConsumablesKpis(updated.kpis);
                setConsumablesTableData(updated.tableData);
                alert('‚úÖ Consumables data uploaded and saved to Firestore successfully!');
            });
        } catch (error) {
            console.error("Error processing consumables Excel file:", error);
            alert("Failed to process the Excel file. Please ensure it's in the correct format.");
        }
    };
    reader.readAsBinaryString(file);
  };

  const handleOTFileUpload = (file) => {
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const workbookData = e.target?.result;
            const workbook = read(workbookData, { type: 'binary' });
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            const json = utils.sheet_to_json(worksheet, { header: 1 });
            const rows = json.slice(1);
            if (rows.length === 0) {
                alert("Excel sheet is empty or invalid.");
                setOtTableData([]);
                setOtKpis([]);
                setOtChartData([]);
                return;
            }
            const newReportData = rows.map(row => {
                if (!row || row.length < 20) return null;
                const monthlyOT = [];
                for (let i = 7; i <= 18; i++) {
                    const val = parseFloat(row[i]);
                    monthlyOT.push(isNaN(val) ? 0 : val);
                }
                const totalOT = parseFloat(row[19]);
                return {
                    id: String(row[0] || ''),
                    employeeId: String(row[1] || ''),
                    name: String(row[2] || ''),
                    position: String(row[3] || ''),
                    department: String(row[4] || ''),
                    grade: String(row[5] || ''),
                    status: String(row[6] || ''),
                    monthlyOT: monthlyOT,
                    totalOT: isNaN(totalOT) ? 0 : totalOT,
                };
            }).filter((item) => item !== null && item.employeeId !== '');
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthlyTotals = Array(12).fill(0);
            const departmentTotals = {};
            let totalOTAll = 0;
            newReportData.forEach(row => {
                row.monthlyOT.forEach((ot, index) => {
                    monthlyTotals[index] += ot;
                });
                departmentTotals[row.department] = (departmentTotals[row.department] || 0) + row.totalOT;
                totalOTAll += row.totalOT;
            });
            const newChartData = monthNames.map((name, index) => ({
                name,
                value: parseFloat(monthlyTotals[index].toFixed(2)),
            }));
            const topDepartment = Object.entries(departmentTotals).sort((a, b) => b[1] - a[1])[0] || ['N/A', 0];
            const topMonthIndex = monthlyTotals.indexOf(Math.max(...monthlyTotals));
            const newKpis = [
                { title: 'Total OT Hours', value: totalOTAll.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}), icon: 'ClockIcon', color: 'text-brand-primary' },
                { title: 'Total Employees', value: newReportData.length.toLocaleString(), icon: 'UsersIcon', color: 'text-brand-secondary' },
                { title: 'Top Department', value: topDepartment[0], icon: 'BuildingOfficeIcon', color: 'text-brand-warning' },
                { title: 'Top Month', value: monthNames[topMonthIndex], icon: 'ChartBarIcon', color: 'text-brand-success' }
            ];
            const payload = { tableData: newReportData, kpis: newKpis, chartData: newChartData };
            
            // Save to Firestore
            saveToFirestore('ot_reports', {
                fileName: file.name,
                fileSize: file.size,
                uploadedAt: new Date().toISOString(),
                data: payload
            });
            
            mockApi.updateOt(payload).then(updated => {
                setOtChartData(updated.chartData);
                setOtKpis(updated.kpis);
                setOtTableData(updated.tableData);
                alert('‚úÖ OT data uploaded and saved to Firestore successfully!');
            });
        } catch (error) {
            console.error("Error processing OT Excel file:", error);
            alert("Failed to process the Excel file. Please ensure it's in the correct format.");
        }
    };
    reader.readAsBinaryString(file);
  };

  const handleLeaveFileUpload = (file) => {
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const workbookData = e.target?.result;
            const workbook = read(workbookData, { type: 'binary' });
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            const json = utils.sheet_to_json(worksheet, { header: 1 });
            const rows = json.slice(1);
            if (rows.length === 0) {
                alert("Excel sheet is empty or invalid.");
                setLeaveTableData([]);
                setLeaveKpis([]);
                setLeaveChartData([]);
                return;
            }
            const newReportData = rows.map((row, index) => {
                if (!row || row.length < 30) return null;
                const getNum = (val) => {
                    if (typeof val === 'number') {
                        return isNaN(val) ? 0 : val;
                    }
                    if (typeof val === 'string') {
                        const cleanedVal = val.replace(/[^0-9.-]+/g, "");
                        if (cleanedVal === '') return 0;
                        const num = parseFloat(cleanedVal);
                        return isNaN(num) ? 0 : num;
                    }
                    return 0;
                };
                const monthlyLeave = [];
                // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 7-18 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (JAN-DEC)
                for (let i = 7; i <= 18; i++) {
                    monthlyLeave.push(getNum(row[i]));
                }
                const employeeId = String(row[1] || ''); // EMP.
                const name = String(row[2] || ''); // NAME-SURENAME
                return {
                    id: String(row[0] || index + 1), // NO.
                    employeeId: employeeId,
                    name: name,
                    position: String(row[3] || ''), // POSITION
                    department: String(row[4] || ''), // DEPT.
                    grade: String(row[5] || ''), // Grade
                    status: String(row[6] || ''), // STATUS
                    monthlyLeave: monthlyLeave,
                    leaveWithoutVacation: getNum(row[19]), // ‡∏¢‡∏≠‡∏î‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô
                    totalLeaveWithVacation: getNum(row[20]), // ‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏£‡∏ß‡∏°‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô
                    vacationCarriedOver: getNum(row[21]), // ‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô‡∏¢‡∏Å‡∏°‡∏≤ 2567
                    vacationEntitlement: getNum(row[22]), // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô 2568
                    totalVacation: getNum(row[23]), // ‡∏£‡∏ß‡∏°‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô 2568
                    vacationUsed: getNum(row[24]), // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô
                    vacationAccrued: getNum(row[25]), // ‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô‡∏™‡∏°‡∏ó‡∏ö2568
                    sickLeave: getNum(row[26]), // ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢
                    personalLeave: getNum(row[27]), // ‡∏•‡∏≤‡∏Å‡∏¥‡∏à
                    birthdayLeave: getNum(row[28]), // ‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î
                    otherLeave: getNum(row[29]), // ‡∏•‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                    totalLeave: getNum(row[30]), // ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                };
            }).filter((item) => item !== null && item.name !== '');
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthlyTotals = Array(12).fill(0);
            const departmentTotals = {};
            const leaveTypeTotals = { 'Sick': 0, 'Personal': 0, 'Birthday': 0, 'Other': 0 };
            let totalLeaveAll = 0;
            newReportData.forEach(row => {
                row.monthlyLeave.forEach((leave, index) => {
                    monthlyTotals[index] += leave;
                });
                departmentTotals[row.department] = (departmentTotals[row.department] || 0) + row.totalLeave;
                leaveTypeTotals['Sick'] += row.sickLeave;
                leaveTypeTotals['Personal'] += row.personalLeave;
                leaveTypeTotals['Birthday'] += row.birthdayLeave;
                leaveTypeTotals['Other'] += row.otherLeave;
                totalLeaveAll += row.totalLeave;
            });
            const newChartData = monthNames.map((name, index) => ({
                name,
                value: parseFloat(monthlyTotals[index].toFixed(2)),
            }));
            const topDepartment = Object.entries(departmentTotals).sort((a, b) => b[1] - a[1])[0] || ['N/A', 0];
            const topLeaveType = Object.entries(leaveTypeTotals).sort((a, b) => b[1] - a[1])[0] || ['N/A', 0];
            const topMonthIndex = monthlyTotals.indexOf(Math.max(...monthlyTotals));
            const newKpis = [
                { title: 'Total Leave Days', value: totalLeaveAll.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}), icon: 'UsersIcon', color: 'text-brand-primary' },
                { title: 'Top Leave Type', value: topLeaveType[0], icon: 'ClipboardDocumentCheckIcon', color: 'text-brand-secondary' },
                { title: 'Top Department', value: topDepartment[0], icon: 'BuildingOfficeIcon', color: 'text-brand-warning' },
                { title: 'Top Month', value: monthNames[topMonthIndex], icon: 'ChartBarIcon', color: 'text-brand-success' }
            ];
            const payload = { tableData: newReportData, kpis: newKpis, chartData: newChartData };
            
            // Save to Firestore
            saveToFirestore('leave_reports', {
                fileName: file.name,
                fileSize: file.size,
                uploadedAt: new Date().toISOString(),
                data: payload
            });
            
            mockApi.updateLeave(payload).then(updated => {
                setLeaveChartData(updated.chartData);
                setLeaveKpis(updated.kpis);
                setLeaveTableData(updated.tableData);
                alert('‚úÖ Leave data uploaded and saved to Firestore successfully!');
            });
        } catch (error) {
            console.error("Error processing Leave Excel file:", error);
            alert("Failed to process the Excel file. Please ensure it's in the correct format.");
        }
    };
    reader.readAsBinaryString(file);
  };

  const handleAccidentFileUpload = (file) => {
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const workbookData = e.target?.result;
            const workbook = read(workbookData, { type: 'binary' });
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            const json = utils.sheet_to_json(worksheet, { header: 1, defval: '' });
            const rows = json.slice(1);
            if (rows.length === 0) {
                alert("Excel sheet is empty or invalid.");
                setAccidentTableData([]);
                return;
            }
            const getNum = (val) => {
                if (typeof val === 'number') return isNaN(val) ? 0 : val;
                if (typeof val === 'string') {
                    const cleanedVal = val.replace(/[^0-9.-]+/g, "");
                    if (cleanedVal === '') return 0;
                    const num = parseFloat(cleanedVal);
                    return isNaN(num) ? 0 : num;
                }
                return 0;
            };
            const newReportData = rows.map(row => {
                if (!row || row.length < 18) return null;
                let incidentDate = row[1];
                if (typeof incidentDate === 'number' && incidentDate > 0) {
                    const excelEpoch = new Date(1899, 11, 30);
                    const jsDate = new Date(excelEpoch.getTime() + incidentDate * 86400000);
                    incidentDate = jsDate.toLocaleDateString('en-GB');
                } else if (incidentDate instanceof Date) {
                    incidentDate = incidentDate.toLocaleDateString('en-GB');
                }
                return {
                    id: String(row[0] || ''),
                    incidentDate: String(incidentDate || ''),
                    incidentTime: String(row[2] || ''),
                    severity: String(row[3] || ''),
                    occurrence: String(row[4] || ''),
                    department: String(row[5] || ''),
                    employeeId: String(row[6] || ''),
                    employeeName: String(row[7] || ''),
                    position: String(row[8] || ''),
                    details: String(row[9] || ''),
                    cause: String(row[10] || ''),
                    prevention: String(row[11] || ''),
                    damageValue: getNum(row[12]),
                    insuranceClaim: String(row[13] || ''),
                    actionTaken: String(row[14] || ''),
                    penalty: String(row[15] || ''),
                    remarks: String(row[16] || ''),
                    accidentLocation: String(row[17] || ''),
                };
            }).filter((item) => item !== null && item.id !== '');
            const departmentTotals = {};
            const severityTotals = {};
            let totalDamage = 0;
            newReportData.forEach(row => {
                if (row.department) {
                    departmentTotals[row.department] = (departmentTotals[row.department] || 0) + 1;
                }
                if (row.severity) {
                    severityTotals[row.severity] = (severityTotals[row.severity] || 0) + 1;
                }
                totalDamage += row.damageValue;
            });
            const newChartData = Object.entries(departmentTotals)
                .map(([name, value]) => ({ name, value }))
                .sort((a, b) => b.value - a.value);
            const topDepartment = Object.entries(departmentTotals).sort((a, b) => b[1] - a[1])[0] || ['N/A', 0];
            const topSeverity = Object.entries(severityTotals).sort((a, b) => b[1] - a[1])[0] || ['N/A', 0];
            const newKpis = [
                { title: 'Total Incidents', value: newReportData.length.toLocaleString(), icon: 'ExclamationTriangleIcon', color: 'text-brand-danger' },
                { title: 'Total Damage Value', value: `‡∏ø${totalDamage.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`, icon: 'CurrencyDollarIcon', color: 'text-brand-warning' },
                { title: 'Top Department', value: topDepartment[0], icon: 'BuildingOfficeIcon', color: 'text-brand-primary' },
                { title: 'Top Severity', value: topSeverity[0], icon: 'ClipboardDocumentCheckIcon', color: 'text-brand-secondary' }
            ];
            const severityColors = ['text-red-400', 'text-orange-400', 'text-amber-400', 'text-yellow-400', 'text-lime-400'];
            Object.entries(severityTotals)
              .sort((a, b) => b[1] - a[1])
              .forEach(([name, value], index) => {
                if (name.trim() !== '') {
                  newKpis.push({
                      title: `‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${name}`,
                      value: `${value.toLocaleString()} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`,
                      icon: 'ClipboardDocumentCheckIcon', 
                      color: severityColors[index % severityColors.length]
                  });
                }
            });
            const payload = { tableData: newReportData, kpis: newKpis, chartData: newChartData };
            
            // Save to Firestore
            saveToFirestore('accident_reports', {
                fileName: file.name,
                fileSize: file.size,
                uploadedAt: new Date().toISOString(),
                data: payload
            });
            
            mockApi.updateAccident(payload).then(updated => {
                setAccidentChartData(updated.chartData);
                setAccidentKpis(updated.kpis);
                setAccidentTableData(updated.tableData);
                alert('‚úÖ Accident data uploaded and saved to Firestore successfully!');
            });
        } catch (error) {
            console.error("Error processing Accident Excel file:", error);
            alert("Failed to process the Excel file. Please ensure it's in the correct format.");
        }
    };
    reader.readAsBinaryString(file);
  };
  
  const handleWorkloadFileUpload = (file) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const workbookData = e.target?.result;
                const workbook = read(workbookData, { type: 'binary' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const json = utils.sheet_to_json(worksheet, { header: 1, defval: null });

                const newWorkloadData = [];
                let currentProductSection = null;

                json.slice(1).forEach(row => { 
                    if (!row || row.every(cell => cell === null)) return;

                    const productCell = row[0];
                    const descriptionCell = row[1];

                    if (productCell && typeof productCell === 'string' && productCell.trim() !== '') {
                        if (currentProductSection) {
                            newWorkloadData.push(currentProductSection);
                        }
                        currentProductSection = {
                            product: productCell.trim(),
                            isSubProduct: productCell.trim() === 'Ton/Person/Hr.',
                            rows: []
                        };
                    }
                    
                    if (descriptionCell && typeof descriptionCell === 'string' && descriptionCell.trim() !== '' && currentProductSection) {
                        const description = descriptionCell.trim();
                        const values = row.slice(3, 15).map(v => parseValue(v));
                        const average = parseValue(row[16]);
                        const min = parseValue(row[17]);
                        const max = parseValue(row[18]);

                        const nonSubRowPrefixes = ['Sum', 'Manpower', 'Workday', 'Working Hours', 'OT'];
                        const isSubRow = !nonSubRowPrefixes.some(prefix => description.startsWith(prefix));

                        currentProductSection.rows.push({
                            description,
                            isSubRow,
                            unit: row[2] || '',
                            values,
                            average,
                            min,
                            max
                        });
                    }
                });

                if (currentProductSection) {
                    newWorkloadData.push(currentProductSection);
                }

                if (newWorkloadData.length > 0) {
                     const payload = { data: newWorkloadData };
                     
                     // Save to Firestore
                     saveToFirestore('workload_reports', {
                         fileName: file.name,
                         fileSize: file.size,
                         uploadedAt: new Date().toISOString(),
                         data: payload
                     });
                     
                    mockApi.updateWorkload(payload).then(updated => {
                        setWorkloadReportData(updated.data);
                        alert('‚úÖ Workload data uploaded and saved to Firestore successfully!');
                    });
                } else {
                    alert("Could not parse any data from the file. Please check the format.");
                }

            } catch (error) {
                console.error("Error processing Workload Excel file:", error);
                alert("Failed to process the Excel file. Please ensure it's in the correct format.");
            }
        };
        reader.readAsBinaryString(file);
    };

  const renderContent = () => {
    switch (activePage) {
      case 'kpiReport':
        return (
          <div className="container mx-auto max-w-[1400px]">
            <div className="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-5 gap-6 mb-8">
              {kpis.map((kpi, index) => (
                <KPICard
                  key={index}
                  title={kpi.title}
                  value={kpi.value}
                  target={kpi.target}
                  trend={kpi.trend}
                  trendDirection={kpi.trendDirection}
                  icon={kpi.icon}
                  color={kpi.color}
                />
              ))}
            </div>
            <div className="flex flex-col gap-8">
              <div className="bg-light-card dark:bg-dark-card border border-light-border dark:border-dark-border rounded-xl shadow-lg p-6">
                <MainChart data={chartData} title={t('kpiProgressOverview')} theme={theme} />
              </div>
              <DataTable data={tableRows} />
            </div>
          </div>
        );
      case 'consumablesReport':
        return <ConsumablesReport 
                  tableData={consumablesTableData}
                  kpis={consumablesKpis}
                  chartData={consumablesChartData}
                  onFileUpload={handleConsumablesFileUpload}
                  theme={theme}
                />;
      case 'otReport':
        return <OTReport
                  tableData={otTableData}
                  kpis={otKpis}
                  chartData={otChartData}
                  onFileUpload={handleOTFileUpload}
                  theme={theme}
                />;
      case 'leaveReport':
        return <LeaveReport
                  tableData={leaveTableData}
                  kpis={leaveKpis}
                  chartData={leaveChartData}
                  onFileUpload={handleLeaveFileUpload}
                  theme={theme}
                />;
      case 'accidentReport':
        return <AccidentReport
                  tableData={accidentTableData}
                  kpis={accidentKpis}
                  chartData={accidentChartData}
                  onFileUpload={handleAccidentFileUpload}
                  theme={theme}
                />;
      case 'workloadReport':
        return <WorkloadReport data={workloadReportData} onFileUpload={handleWorkloadFileUpload} theme={theme} />;
      case 'reports':
        return <PlaceholderPage title={t('reports')} />;
      case 'documents':
        return <PlaceholderPage title={t('documents')} />;
      case 'settings':
        return <PlaceholderPage title={t('settings')} />;
      case 'helpCenter':
        return <PlaceholderPage title={t('helpCenter')} />;
      default:
        return <PlaceholderPage title="Page Not Found" />;
    }
  };
  
  if (isLoading) {
      return <LoadingSpinner />;
  }

  return (
    <div className="flex h-screen bg-light-bg dark:bg-dark-bg text-light-text-primary dark:text-dark-text-primary">
      {isSidebarOpen && (
            <div
                className="fixed inset-0 bg-black/50 z-40 lg:hidden"
                onClick={() => setIsSidebarOpen(false)}
                aria-hidden="true"
            ></div>
        )}
      <Sidebar activePage={activePage} onNavigate={handleNavigate} isOpen={isSidebarOpen} onClose={() => setIsSidebarOpen(false)} />
      <div className="flex-1 flex flex-col overflow-hidden">
        <Header 
            onFileUpload={handleDashboardFileUpload} 
            activePage={activePage} 
            theme={theme} 
            toggleTheme={toggleTheme} 
            onMenuClick={() => setIsSidebarOpen(true)}
            onShareReport={handleShareReport}
            onLoadReport={handleLoadReport}
            onLoadFromFirestore={handleLoadFromFirestore}
            onClearData={handleClearAllData}
        />
        <main className="flex-1 overflow-x-hidden overflow-y-auto bg-light-bg dark:bg-dark-bg p-6 lg:p-8">
          {renderContent()}
        </main>
      </div>
    </div>
  );
};
// ===================================================
// END: App.tsx
// ===================================================


// ===================================================
// START: index.tsx (Entry point)
// ===================================================
const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}
const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <LanguageProvider>
      <App />
    </LanguageProvider>
  </React.StrictMode>
);
// ===================================================
// END: index.tsx
// ===================================================

    </script>
  </body>
</html>
